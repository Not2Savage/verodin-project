'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _path = require('path');

var _debug = require('debug');

var _debug2 = _interopRequireDefault(_debug);

var _pinkie = require('pinkie');

var _pinkie2 = _interopRequireDefault(_pinkie);

var _promisifyEvent = require('promisify-event');

var _promisifyEvent2 = _interopRequireDefault(_promisifyEvent);

var _mapReverse = require('map-reverse');

var _mapReverse2 = _interopRequireDefault(_mapReverse);

var _events = require('events');

var _lodash = require('lodash');

var _bootstrapper = require('./bootstrapper');

var _bootstrapper2 = _interopRequireDefault(_bootstrapper);

var _reporter = require('../reporter');

var _reporter2 = _interopRequireDefault(_reporter);

var _task = require('./task');

var _task2 = _interopRequireDefault(_task);

var _runtime = require('../errors/runtime');

var _types = require('../errors/types');

var _typeAssertions = require('../errors/runtime/type-assertions');

var _renderForbiddenCharsList = require('../errors/render-forbidden-chars-list');

var _renderForbiddenCharsList2 = _interopRequireDefault(_renderForbiddenCharsList);

var _detectFfmpeg = require('../utils/detect-ffmpeg');

var _detectFfmpeg2 = _interopRequireDefault(_detectFfmpeg);

var _checkFilePath = require('../utils/check-file-path');

var _checkFilePath2 = _interopRequireDefault(_checkFilePath);

var _handleErrors = require('../utils/handle-errors');

var _optionNames = require('../configuration/option-names');

var _optionNames2 = _interopRequireDefault(_optionNames);

var _flagList = require('../utils/flag-list');

var _flagList2 = _interopRequireDefault(_flagList);

var _prepareReporters = require('../utils/prepare-reporters');

var _prepareReporters2 = _interopRequireDefault(_prepareReporters);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const DEBUG_LOGGER = (0, _debug2.default)('testcafe:runner');

class Runner extends _events.EventEmitter {
    constructor(proxy, browserConnectionGateway, configuration) {
        super();

        this.proxy = proxy;
        this.bootstrapper = this._createBootstrapper(browserConnectionGateway);
        this.pendingTaskPromises = [];
        this.configuration = configuration;
        this.isCli = false;

        this.apiMethodWasCalled = new _flagList2.default({
            initialFlagValue: false,
            flags: [_optionNames2.default.src, _optionNames2.default.browsers, _optionNames2.default.reporter]
        });
    }

    _createBootstrapper(browserConnectionGateway) {
        return new _bootstrapper2.default(browserConnectionGateway);
    }

    _disposeBrowserSet(browserSet) {
        return browserSet.dispose().catch(e => DEBUG_LOGGER(e));
    }

    _disposeReporters(reporters) {
        return _pinkie2.default.all(reporters.map(reporter => reporter.dispose().catch(e => DEBUG_LOGGER(e))));
    }

    _disposeTestedApp(testedApp) {
        return testedApp ? testedApp.kill().catch(e => DEBUG_LOGGER(e)) : _pinkie2.default.resolve();
    }

    _disposeTaskAndRelatedAssets(task, browserSet, reporters, testedApp) {
        var _this = this;

        return (0, _asyncToGenerator3.default)(function* () {
            task.abort();
            task.clearListeners();

            yield _this._disposeAssets(browserSet, reporters, testedApp);
        })();
    }

    _disposeAssets(browserSet, reporters, testedApp) {
        return _pinkie2.default.all([this._disposeBrowserSet(browserSet), this._disposeReporters(reporters), this._disposeTestedApp(testedApp)]);
    }

    _prepareArrayParameter(array) {
        array = (0, _lodash.flattenDeep)(array);

        if (this.isCli) return array.length === 0 ? void 0 : array;

        return array;
    }

    _createCancelablePromise(taskPromise) {
        const promise = taskPromise.then(({ completionPromise }) => completionPromise);
        const removeFromPending = () => (0, _lodash.pull)(this.pendingTaskPromises, promise);

        promise.then(removeFromPending).catch(removeFromPending);

        promise.cancel = () => taskPromise.then(({ cancelTask }) => cancelTask()).then(removeFromPending);

        this.pendingTaskPromises.push(promise);
        return promise;
    }

    // Run task
    _getFailedTestCount(task, reporter) {
        let failedTestCount = reporter.testCount - reporter.passed;

        if (task.opts.stopOnFirstFail && !!failedTestCount) failedTestCount = 1;

        return failedTestCount;
    }

    _getTaskResult(task, browserSet, reporters, testedApp) {
        var _this2 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            task.on('browser-job-done', function (job) {
                return browserSet.releaseConnection(job.browserConnection);
            });

            const browserSetErrorPromise = (0, _promisifyEvent2.default)(browserSet, 'error');

            const taskDonePromise = task.once('done').then(function () {
                return browserSetErrorPromise.cancel();
            });

            const promises = [taskDonePromise, browserSetErrorPromise];

            if (testedApp) promises.push(testedApp.errorPromise);

            try {
                yield _pinkie2.default.race(promises);
            } catch (err) {
                yield _this2._disposeTaskAndRelatedAssets(task, browserSet, reporters, testedApp);

                throw err;
            }

            yield _this2._disposeAssets(browserSet, reporters, testedApp);

            return _this2._getFailedTestCount(task, reporters[0]);
        })();
    }

    _createTask(tests, browserConnectionGroups, proxy, opts) {
        return new _task2.default(tests, browserConnectionGroups, proxy, opts);
    }

    _runTask(reporterPlugins, browserSet, tests, testedApp) {
        var _this3 = this;

        let completed = false;
        const task = this._createTask(tests, browserSet.browserConnectionGroups, this.proxy, this.configuration.getOptions());
        const reporters = reporterPlugins.map(reporter => new _reporter2.default(reporter.plugin, task, reporter.outStream));
        const completionPromise = this._getTaskResult(task, browserSet, reporters, testedApp);

        task.on('start', _handleErrors.startHandlingTestErrors);

        if (!this.configuration.getOption(_optionNames2.default.skipUncaughtErrors)) {
            task.once('test-run-start', _handleErrors.addRunningTest);
            task.once('test-run-done', _handleErrors.removeRunningTest);
        }

        task.on('done', _handleErrors.stopHandlingTestErrors);

        const setCompleted = () => {
            completed = true;
        };

        completionPromise.then(setCompleted).catch(setCompleted);

        const cancelTask = (() => {
            var _ref = (0, _asyncToGenerator3.default)(function* () {
                if (!completed) yield _this3._disposeTaskAndRelatedAssets(task, browserSet, reporters, testedApp);
            });

            return function cancelTask() {
                return _ref.apply(this, arguments);
            };
        })();

        return { completionPromise, cancelTask };
    }

    _registerAssets(assets) {
        assets.forEach(asset => this.proxy.GET(asset.path, asset.info));
    }

    _validateSpeedOption() {
        const speed = this.configuration.getOption(_optionNames2.default.speed);

        if (speed === void 0) return;

        if (typeof speed !== 'number' || isNaN(speed) || speed < 0.01 || speed > 1) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.invalidSpeedValue);
    }

    _validateConcurrencyOption() {
        const concurrency = this.configuration.getOption(_optionNames2.default.concurrency);

        if (concurrency === void 0) return;

        if (typeof concurrency !== 'number' || isNaN(concurrency) || concurrency < 1) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.invalidConcurrencyFactor);
    }

    _validateProxyBypassOption() {
        let proxyBypass = this.configuration.getOption(_optionNames2.default.proxyBypass);

        if (proxyBypass === void 0) return;

        (0, _typeAssertions.assertType)([_typeAssertions.is.string, _typeAssertions.is.array], null, '"proxyBypass" argument', proxyBypass);

        if (typeof proxyBypass === 'string') proxyBypass = [proxyBypass];

        proxyBypass = proxyBypass.reduce((arr, rules) => {
            (0, _typeAssertions.assertType)(_typeAssertions.is.string, null, '"proxyBypass" argument', rules);

            return arr.concat(rules.split(','));
        }, []);

        this.configuration.mergeOptions({ proxyBypass });
    }

    _validateScreenshotOptions() {
        const screenshotPath = this.configuration.getOption(_optionNames2.default.screenshotPath);
        const screenshotPathPattern = this.configuration.getOption(_optionNames2.default.screenshotPathPattern);

        if (screenshotPath) {
            this._validateScreenshotPath(screenshotPath, 'screenshots base directory path');

            this.configuration.mergeOptions({ [_optionNames2.default.screenshotPath]: (0, _path.resolve)(screenshotPath) });
        }

        if (screenshotPathPattern) this._validateScreenshotPath(screenshotPathPattern, 'screenshots path pattern');

        if (!screenshotPath && screenshotPathPattern) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.cannotUseScreenshotPathPatternWithoutBaseScreenshotPathSpecified);
    }

    _validateVideoOptions() {
        var _this4 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const videoPath = _this4.configuration.getOption(_optionNames2.default.videoPath);
            const videoEncodingOptions = _this4.configuration.getOption(_optionNames2.default.videoEncodingOptions);

            let videoOptions = _this4.configuration.getOption(_optionNames2.default.videoOptions);

            if (!videoPath) {
                if (videoOptions || videoEncodingOptions) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.cannotSetVideoOptionsWithoutBaseVideoPathSpecified);

                return;
            }

            _this4.configuration.mergeOptions({ [_optionNames2.default.videoPath]: (0, _path.resolve)(videoPath) });

            if (!videoOptions) {
                videoOptions = {};

                _this4.configuration.mergeOptions({ [_optionNames2.default.videoOptions]: videoOptions });
            }

            if (videoOptions.ffmpegPath) videoOptions.ffmpegPath = (0, _path.resolve)(videoOptions.ffmpegPath);else videoOptions.ffmpegPath = yield (0, _detectFfmpeg2.default)();

            if (!videoOptions.ffmpegPath) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.cannotFindFFMPEG);
        })();
    }

    _validateRunOptions() {
        var _this5 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this5._validateScreenshotOptions();
            yield _this5._validateVideoOptions();
            _this5._validateSpeedOption();
            _this5._validateConcurrencyOption();
            _this5._validateProxyBypassOption();
        })();
    }

    _createRunnableConfiguration() {
        return this.bootstrapper.createRunnableConfiguration();
    }

    _validateScreenshotPath(screenshotPath, pathType) {
        const forbiddenCharsList = (0, _checkFilePath2.default)(screenshotPath);

        if (forbiddenCharsList.length) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.forbiddenCharatersInScreenshotPath, screenshotPath, pathType, (0, _renderForbiddenCharsList2.default)(forbiddenCharsList));
    }

    _setBootstrapperOptions() {
        this.configuration.prepare();
        this.configuration.notifyAboutOverridenOptions();

        this.bootstrapper.sources = this.configuration.getOption(_optionNames2.default.src) || this.bootstrapper.sources;
        this.bootstrapper.browsers = this.configuration.getOption(_optionNames2.default.browsers) || this.bootstrapper.browsers;
        this.bootstrapper.concurrency = this.configuration.getOption(_optionNames2.default.concurrency);
        this.bootstrapper.appCommand = this.configuration.getOption(_optionNames2.default.appCommand) || this.bootstrapper.appCommand;
        this.bootstrapper.appInitDelay = this.configuration.getOption(_optionNames2.default.appInitDelay);
        this.bootstrapper.filter = this.configuration.getOption(_optionNames2.default.filter) || this.bootstrapper.filter;
        this.bootstrapper.reporters = this.configuration.getOption(_optionNames2.default.reporter) || this.bootstrapper.reporters;
    }

    // API
    embeddingOptions(opts) {
        const assets = opts.assets,
              TestRunCtor = opts.TestRunCtor;


        this._registerAssets(assets);
        this.configuration.mergeOptions({ TestRunCtor });

        return this;
    }

    src(...sources) {
        if (this.apiMethodWasCalled.src) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.multipleAPIMethodCallForbidden, _optionNames2.default.src);

        sources = this._prepareArrayParameter(sources);
        this.configuration.mergeOptions({ [_optionNames2.default.src]: sources });

        this.apiMethodWasCalled.src = true;

        return this;
    }

    browsers(...browsers) {
        if (this.apiMethodWasCalled.browsers) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.multipleAPIMethodCallForbidden, _optionNames2.default.browsers);

        browsers = this._prepareArrayParameter(browsers);
        this.configuration.mergeOptions({ browsers });

        this.apiMethodWasCalled.browsers = true;

        return this;
    }

    concurrency(concurrency) {
        this.configuration.mergeOptions({ concurrency });

        return this;
    }

    reporter(name, output) {
        if (this.apiMethodWasCalled.reporter) throw new _runtime.GeneralError(_types.RUNTIME_ERRORS.multipleAPIMethodCallForbidden, _optionNames2.default.reporter);

        let reporters = (0, _prepareReporters2.default)(name, output);

        reporters = this._prepareArrayParameter(reporters);

        this.configuration.mergeOptions({ [_optionNames2.default.reporter]: reporters });

        this.apiMethodWasCalled.reporter = true;

        return this;
    }

    filter(filter) {
        this.configuration.mergeOptions({ filter });

        return this;
    }

    useProxy(proxy, proxyBypass) {
        this.configuration.mergeOptions({ proxy, proxyBypass });

        return this;
    }

    screenshots(path, takeOnFails, pattern) {
        this.configuration.mergeOptions({
            [_optionNames2.default.screenshotPath]: path,
            [_optionNames2.default.takeScreenshotsOnFails]: takeOnFails,
            [_optionNames2.default.screenshotPathPattern]: pattern
        });

        return this;
    }

    video(path, options, encodingOptions) {
        this.configuration.mergeOptions({
            [_optionNames2.default.videoPath]: path,
            [_optionNames2.default.videoOptions]: options,
            [_optionNames2.default.videoEncodingOptions]: encodingOptions
        });

        return this;
    }

    startApp(command, initDelay) {
        this.configuration.mergeOptions({
            [_optionNames2.default.appCommand]: command,
            [_optionNames2.default.appInitDelay]: initDelay
        });

        return this;
    }

    run(options = {}) {
        this.apiMethodWasCalled.reset();

        const skipJsErrors = options.skipJsErrors,
              disablePageReloads = options.disablePageReloads,
              quarantineMode = options.quarantineMode,
              debugMode = options.debugMode,
              selectorTimeout = options.selectorTimeout,
              assertionTimeout = options.assertionTimeout,
              pageLoadTimeout = options.pageLoadTimeout,
              speed = options.speed,
              debugOnFail = options.debugOnFail,
              skipUncaughtErrors = options.skipUncaughtErrors,
              stopOnFirstFail = options.stopOnFirstFail;


        this.configuration.mergeOptions({
            skipJsErrors: skipJsErrors,
            disablePageReloads: disablePageReloads,
            quarantineMode: quarantineMode,
            debugMode: debugMode,
            debugOnFail: debugOnFail,
            selectorTimeout: selectorTimeout,
            assertionTimeout: assertionTimeout,
            pageLoadTimeout: pageLoadTimeout,
            speed: speed,
            skipUncaughtErrors: skipUncaughtErrors,
            stopOnFirstFail: stopOnFirstFail
        });

        this._setBootstrapperOptions();

        const runTaskPromise = _pinkie2.default.resolve().then(() => this._validateRunOptions()).then(() => this._createRunnableConfiguration()).then(({ reporterPlugins, browserSet, tests, testedApp }) => {
            this.emit('done-bootstrapping');

            return this._runTask(reporterPlugins, browserSet, tests, testedApp);
        });

        return this._createCancelablePromise(runTaskPromise);
    }

    stop() {
        var _this6 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            // NOTE: When taskPromise is cancelled, it is removed from
            // the pendingTaskPromises array, which leads to shifting indexes
            // towards the beginning. So, we must copy the array in order to iterate it,
            // or we can perform iteration from the end to the beginning.
            const cancellationPromises = (0, _mapReverse2.default)(_this6.pendingTaskPromises, function (taskPromise) {
                return taskPromise.cancel();
            });

            yield _pinkie2.default.all(cancellationPromises);
        })();
    }
}
exports.default = Runner;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydW5uZXIvaW5kZXguanMiXSwibmFtZXMiOlsiREVCVUdfTE9HR0VSIiwiUnVubmVyIiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJwcm94eSIsImJyb3dzZXJDb25uZWN0aW9uR2F0ZXdheSIsImNvbmZpZ3VyYXRpb24iLCJib290c3RyYXBwZXIiLCJfY3JlYXRlQm9vdHN0cmFwcGVyIiwicGVuZGluZ1Rhc2tQcm9taXNlcyIsImlzQ2xpIiwiYXBpTWV0aG9kV2FzQ2FsbGVkIiwiRmxhZ0xpc3QiLCJpbml0aWFsRmxhZ1ZhbHVlIiwiZmxhZ3MiLCJPUFRJT05fTkFNRVMiLCJzcmMiLCJicm93c2VycyIsInJlcG9ydGVyIiwiQm9vdHN0cmFwcGVyIiwiX2Rpc3Bvc2VCcm93c2VyU2V0IiwiYnJvd3NlclNldCIsImRpc3Bvc2UiLCJjYXRjaCIsImUiLCJfZGlzcG9zZVJlcG9ydGVycyIsInJlcG9ydGVycyIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJfZGlzcG9zZVRlc3RlZEFwcCIsInRlc3RlZEFwcCIsImtpbGwiLCJyZXNvbHZlIiwiX2Rpc3Bvc2VUYXNrQW5kUmVsYXRlZEFzc2V0cyIsInRhc2siLCJhYm9ydCIsImNsZWFyTGlzdGVuZXJzIiwiX2Rpc3Bvc2VBc3NldHMiLCJfcHJlcGFyZUFycmF5UGFyYW1ldGVyIiwiYXJyYXkiLCJsZW5ndGgiLCJfY3JlYXRlQ2FuY2VsYWJsZVByb21pc2UiLCJ0YXNrUHJvbWlzZSIsInByb21pc2UiLCJ0aGVuIiwiY29tcGxldGlvblByb21pc2UiLCJyZW1vdmVGcm9tUGVuZGluZyIsImNhbmNlbCIsImNhbmNlbFRhc2siLCJwdXNoIiwiX2dldEZhaWxlZFRlc3RDb3VudCIsImZhaWxlZFRlc3RDb3VudCIsInRlc3RDb3VudCIsInBhc3NlZCIsIm9wdHMiLCJzdG9wT25GaXJzdEZhaWwiLCJfZ2V0VGFza1Jlc3VsdCIsIm9uIiwicmVsZWFzZUNvbm5lY3Rpb24iLCJqb2IiLCJicm93c2VyQ29ubmVjdGlvbiIsImJyb3dzZXJTZXRFcnJvclByb21pc2UiLCJ0YXNrRG9uZVByb21pc2UiLCJvbmNlIiwicHJvbWlzZXMiLCJlcnJvclByb21pc2UiLCJyYWNlIiwiZXJyIiwiX2NyZWF0ZVRhc2siLCJ0ZXN0cyIsImJyb3dzZXJDb25uZWN0aW9uR3JvdXBzIiwiVGFzayIsIl9ydW5UYXNrIiwicmVwb3J0ZXJQbHVnaW5zIiwiY29tcGxldGVkIiwiZ2V0T3B0aW9ucyIsIlJlcG9ydGVyIiwicGx1Z2luIiwib3V0U3RyZWFtIiwic3RhcnRIYW5kbGluZ1Rlc3RFcnJvcnMiLCJnZXRPcHRpb24iLCJza2lwVW5jYXVnaHRFcnJvcnMiLCJhZGRSdW5uaW5nVGVzdCIsInJlbW92ZVJ1bm5pbmdUZXN0Iiwic3RvcEhhbmRsaW5nVGVzdEVycm9ycyIsInNldENvbXBsZXRlZCIsIl9yZWdpc3RlckFzc2V0cyIsImFzc2V0cyIsImZvckVhY2giLCJhc3NldCIsIkdFVCIsInBhdGgiLCJpbmZvIiwiX3ZhbGlkYXRlU3BlZWRPcHRpb24iLCJzcGVlZCIsImlzTmFOIiwiR2VuZXJhbEVycm9yIiwiUlVOVElNRV9FUlJPUlMiLCJpbnZhbGlkU3BlZWRWYWx1ZSIsIl92YWxpZGF0ZUNvbmN1cnJlbmN5T3B0aW9uIiwiY29uY3VycmVuY3kiLCJpbnZhbGlkQ29uY3VycmVuY3lGYWN0b3IiLCJfdmFsaWRhdGVQcm94eUJ5cGFzc09wdGlvbiIsInByb3h5QnlwYXNzIiwiaXMiLCJzdHJpbmciLCJyZWR1Y2UiLCJhcnIiLCJydWxlcyIsImNvbmNhdCIsInNwbGl0IiwibWVyZ2VPcHRpb25zIiwiX3ZhbGlkYXRlU2NyZWVuc2hvdE9wdGlvbnMiLCJzY3JlZW5zaG90UGF0aCIsInNjcmVlbnNob3RQYXRoUGF0dGVybiIsIl92YWxpZGF0ZVNjcmVlbnNob3RQYXRoIiwiY2Fubm90VXNlU2NyZWVuc2hvdFBhdGhQYXR0ZXJuV2l0aG91dEJhc2VTY3JlZW5zaG90UGF0aFNwZWNpZmllZCIsIl92YWxpZGF0ZVZpZGVvT3B0aW9ucyIsInZpZGVvUGF0aCIsInZpZGVvRW5jb2RpbmdPcHRpb25zIiwidmlkZW9PcHRpb25zIiwiY2Fubm90U2V0VmlkZW9PcHRpb25zV2l0aG91dEJhc2VWaWRlb1BhdGhTcGVjaWZpZWQiLCJmZm1wZWdQYXRoIiwiY2Fubm90RmluZEZGTVBFRyIsIl92YWxpZGF0ZVJ1bk9wdGlvbnMiLCJfY3JlYXRlUnVubmFibGVDb25maWd1cmF0aW9uIiwiY3JlYXRlUnVubmFibGVDb25maWd1cmF0aW9uIiwicGF0aFR5cGUiLCJmb3JiaWRkZW5DaGFyc0xpc3QiLCJmb3JiaWRkZW5DaGFyYXRlcnNJblNjcmVlbnNob3RQYXRoIiwiX3NldEJvb3RzdHJhcHBlck9wdGlvbnMiLCJwcmVwYXJlIiwibm90aWZ5QWJvdXRPdmVycmlkZW5PcHRpb25zIiwic291cmNlcyIsImFwcENvbW1hbmQiLCJhcHBJbml0RGVsYXkiLCJmaWx0ZXIiLCJlbWJlZGRpbmdPcHRpb25zIiwiVGVzdFJ1bkN0b3IiLCJtdWx0aXBsZUFQSU1ldGhvZENhbGxGb3JiaWRkZW4iLCJuYW1lIiwib3V0cHV0IiwidXNlUHJveHkiLCJzY3JlZW5zaG90cyIsInRha2VPbkZhaWxzIiwicGF0dGVybiIsInRha2VTY3JlZW5zaG90c09uRmFpbHMiLCJ2aWRlbyIsIm9wdGlvbnMiLCJlbmNvZGluZ09wdGlvbnMiLCJzdGFydEFwcCIsImNvbW1hbmQiLCJpbml0RGVsYXkiLCJydW4iLCJyZXNldCIsInNraXBKc0Vycm9ycyIsImRpc2FibGVQYWdlUmVsb2FkcyIsInF1YXJhbnRpbmVNb2RlIiwiZGVidWdNb2RlIiwic2VsZWN0b3JUaW1lb3V0IiwiYXNzZXJ0aW9uVGltZW91dCIsInBhZ2VMb2FkVGltZW91dCIsImRlYnVnT25GYWlsIiwicnVuVGFza1Byb21pc2UiLCJlbWl0Iiwic3RvcCIsImNhbmNlbGxhdGlvblByb21pc2VzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7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QkMsNkJBQW9CQSxlQVJRO0FBUzVCbkUsbUJBQW9CQSxLQVRRO0FBVTVCYixnQ0FBb0JBLGtCQVZRO0FBVzVCMUIsNkJBQW9CQTtBQVhRLFNBQWhDOztBQWNBLGFBQUsyRSx1QkFBTDs7QUFFQSxjQUFNaUMsaUJBQWlCekksaUJBQVFNLE9BQVIsR0FDbEJZLElBRGtCLENBQ2IsTUFBTSxLQUFLZ0YsbUJBQUwsRUFETyxFQUVsQmhGLElBRmtCLENBRWIsTUFBTSxLQUFLaUYsNEJBQUwsRUFGTyxFQUdsQmpGLElBSGtCLENBR2IsQ0FBQyxFQUFFNkIsZUFBRixFQUFtQnJELFVBQW5CLEVBQStCaUQsS0FBL0IsRUFBc0N2QyxTQUF0QyxFQUFELEtBQXVEO0FBQ3pELGlCQUFLc0ksSUFBTCxDQUFVLG9CQUFWOztBQUVBLG1CQUFPLEtBQUs1RixRQUFMLENBQWNDLGVBQWQsRUFBK0JyRCxVQUEvQixFQUEyQ2lELEtBQTNDLEVBQWtEdkMsU0FBbEQsQ0FBUDtBQUNILFNBUGtCLENBQXZCOztBQVNBLGVBQU8sS0FBS1csd0JBQUwsQ0FBOEIwSCxjQUE5QixDQUFQO0FBQ0g7O0FBRUtFLFFBQU4sR0FBYztBQUFBOztBQUFBO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBTUMsdUJBQXVCLDBCQUFXLE9BQUs5SixtQkFBaEIsRUFBcUM7QUFBQSx1QkFBZWtDLFlBQVlLLE1BQVosRUFBZjtBQUFBLGFBQXJDLENBQTdCOztBQUVBLGtCQUFNckIsaUJBQVFDLEdBQVIsQ0FBWTJJLG9CQUFaLENBQU47QUFQVTtBQVFiO0FBcGE0QztrQkFBNUJ0SyxNIiwiZmlsZSI6InJ1bm5lci9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlc29sdmUgYXMgcmVzb2x2ZVBhdGggfSBmcm9tICdwYXRoJztcbmltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5pbXBvcnQgUHJvbWlzZSBmcm9tICdwaW5raWUnO1xuaW1wb3J0IHByb21pc2lmeUV2ZW50IGZyb20gJ3Byb21pc2lmeS1ldmVudCc7XG5pbXBvcnQgbWFwUmV2ZXJzZSBmcm9tICdtYXAtcmV2ZXJzZSc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgZmxhdHRlbkRlZXAgYXMgZmxhdHRlbiwgcHVsbCBhcyByZW1vdmUgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEJvb3RzdHJhcHBlciBmcm9tICcuL2Jvb3RzdHJhcHBlcic7XG5pbXBvcnQgUmVwb3J0ZXIgZnJvbSAnLi4vcmVwb3J0ZXInO1xuaW1wb3J0IFRhc2sgZnJvbSAnLi90YXNrJztcbmltcG9ydCB7IEdlbmVyYWxFcnJvciB9IGZyb20gJy4uL2Vycm9ycy9ydW50aW1lJztcbmltcG9ydCB7IFJVTlRJTUVfRVJST1JTIH0gZnJvbSAnLi4vZXJyb3JzL3R5cGVzJztcbmltcG9ydCB7IGFzc2VydFR5cGUsIGlzIH0gZnJvbSAnLi4vZXJyb3JzL3J1bnRpbWUvdHlwZS1hc3NlcnRpb25zJztcbmltcG9ydCByZW5kZXJGb3JiaWRkZW5DaGFyc0xpc3QgZnJvbSAnLi4vZXJyb3JzL3JlbmRlci1mb3JiaWRkZW4tY2hhcnMtbGlzdCc7XG5pbXBvcnQgZGV0ZWN0RkZNUEVHIGZyb20gJy4uL3V0aWxzL2RldGVjdC1mZm1wZWcnO1xuaW1wb3J0IGNoZWNrRmlsZVBhdGggZnJvbSAnLi4vdXRpbHMvY2hlY2stZmlsZS1wYXRoJztcbmltcG9ydCB7IGFkZFJ1bm5pbmdUZXN0LCByZW1vdmVSdW5uaW5nVGVzdCwgc3RhcnRIYW5kbGluZ1Rlc3RFcnJvcnMsIHN0b3BIYW5kbGluZ1Rlc3RFcnJvcnMgfSBmcm9tICcuLi91dGlscy9oYW5kbGUtZXJyb3JzJztcbmltcG9ydCBPUFRJT05fTkFNRVMgZnJvbSAnLi4vY29uZmlndXJhdGlvbi9vcHRpb24tbmFtZXMnO1xuaW1wb3J0IEZsYWdMaXN0IGZyb20gJy4uL3V0aWxzL2ZsYWctbGlzdCc7XG5pbXBvcnQgcHJlcGFyZVJlcG9ydGVycyBmcm9tICcuLi91dGlscy9wcmVwYXJlLXJlcG9ydGVycyc7XG5cbmNvbnN0IERFQlVHX0xPR0dFUiA9IGRlYnVnKCd0ZXN0Y2FmZTpydW5uZXInKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnVubmVyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvciAocHJveHksIGJyb3dzZXJDb25uZWN0aW9uR2F0ZXdheSwgY29uZmlndXJhdGlvbikge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMucHJveHkgICAgICAgICAgICAgICA9IHByb3h5O1xuICAgICAgICB0aGlzLmJvb3RzdHJhcHBlciAgICAgICAgPSB0aGlzLl9jcmVhdGVCb290c3RyYXBwZXIoYnJvd3NlckNvbm5lY3Rpb25HYXRld2F5KTtcbiAgICAgICAgdGhpcy5wZW5kaW5nVGFza1Byb21pc2VzID0gW107XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiAgICAgICA9IGNvbmZpZ3VyYXRpb247XG4gICAgICAgIHRoaXMuaXNDbGkgICAgICAgICAgICAgICA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYXBpTWV0aG9kV2FzQ2FsbGVkID0gbmV3IEZsYWdMaXN0KHtcbiAgICAgICAgICAgIGluaXRpYWxGbGFnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZmxhZ3M6ICAgICAgICAgICAgW09QVElPTl9OQU1FUy5zcmMsIE9QVElPTl9OQU1FUy5icm93c2VycywgT1BUSU9OX05BTUVTLnJlcG9ydGVyXVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfY3JlYXRlQm9vdHN0cmFwcGVyIChicm93c2VyQ29ubmVjdGlvbkdhdGV3YXkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCb290c3RyYXBwZXIoYnJvd3NlckNvbm5lY3Rpb25HYXRld2F5KTtcbiAgICB9XG5cbiAgICBfZGlzcG9zZUJyb3dzZXJTZXQgKGJyb3dzZXJTZXQpIHtcbiAgICAgICAgcmV0dXJuIGJyb3dzZXJTZXQuZGlzcG9zZSgpLmNhdGNoKGUgPT4gREVCVUdfTE9HR0VSKGUpKTtcbiAgICB9XG5cbiAgICBfZGlzcG9zZVJlcG9ydGVycyAocmVwb3J0ZXJzKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChyZXBvcnRlcnMubWFwKHJlcG9ydGVyID0+IHJlcG9ydGVyLmRpc3Bvc2UoKS5jYXRjaChlID0+IERFQlVHX0xPR0dFUihlKSkpKTtcbiAgICB9XG5cbiAgICBfZGlzcG9zZVRlc3RlZEFwcCAodGVzdGVkQXBwKSB7XG4gICAgICAgIHJldHVybiB0ZXN0ZWRBcHAgPyB0ZXN0ZWRBcHAua2lsbCgpLmNhdGNoKGUgPT4gREVCVUdfTE9HR0VSKGUpKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIGFzeW5jIF9kaXNwb3NlVGFza0FuZFJlbGF0ZWRBc3NldHMgKHRhc2ssIGJyb3dzZXJTZXQsIHJlcG9ydGVycywgdGVzdGVkQXBwKSB7XG4gICAgICAgIHRhc2suYWJvcnQoKTtcbiAgICAgICAgdGFzay5jbGVhckxpc3RlbmVycygpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuX2Rpc3Bvc2VBc3NldHMoYnJvd3NlclNldCwgcmVwb3J0ZXJzLCB0ZXN0ZWRBcHApO1xuICAgIH1cblxuICAgIF9kaXNwb3NlQXNzZXRzIChicm93c2VyU2V0LCByZXBvcnRlcnMsIHRlc3RlZEFwcCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5fZGlzcG9zZUJyb3dzZXJTZXQoYnJvd3NlclNldCksXG4gICAgICAgICAgICB0aGlzLl9kaXNwb3NlUmVwb3J0ZXJzKHJlcG9ydGVycyksXG4gICAgICAgICAgICB0aGlzLl9kaXNwb3NlVGVzdGVkQXBwKHRlc3RlZEFwcClcbiAgICAgICAgXSk7XG4gICAgfVxuXG4gICAgX3ByZXBhcmVBcnJheVBhcmFtZXRlciAoYXJyYXkpIHtcbiAgICAgICAgYXJyYXkgPSBmbGF0dGVuKGFycmF5KTtcblxuICAgICAgICBpZiAodGhpcy5pc0NsaSlcbiAgICAgICAgICAgIHJldHVybiBhcnJheS5sZW5ndGggPT09IDAgPyB2b2lkIDAgOiBhcnJheTtcblxuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNhbmNlbGFibGVQcm9taXNlICh0YXNrUHJvbWlzZSkge1xuICAgICAgICBjb25zdCBwcm9taXNlICAgICAgICAgICA9IHRhc2tQcm9taXNlLnRoZW4oKHsgY29tcGxldGlvblByb21pc2UgfSkgPT4gY29tcGxldGlvblByb21pc2UpO1xuICAgICAgICBjb25zdCByZW1vdmVGcm9tUGVuZGluZyA9ICgpID0+IHJlbW92ZSh0aGlzLnBlbmRpbmdUYXNrUHJvbWlzZXMsIHByb21pc2UpO1xuXG4gICAgICAgIHByb21pc2VcbiAgICAgICAgICAgIC50aGVuKHJlbW92ZUZyb21QZW5kaW5nKVxuICAgICAgICAgICAgLmNhdGNoKHJlbW92ZUZyb21QZW5kaW5nKTtcblxuICAgICAgICBwcm9taXNlLmNhbmNlbCA9ICgpID0+IHRhc2tQcm9taXNlXG4gICAgICAgICAgICAudGhlbigoeyBjYW5jZWxUYXNrIH0pID0+IGNhbmNlbFRhc2soKSlcbiAgICAgICAgICAgIC50aGVuKHJlbW92ZUZyb21QZW5kaW5nKTtcblxuICAgICAgICB0aGlzLnBlbmRpbmdUYXNrUHJvbWlzZXMucHVzaChwcm9taXNlKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfVxuXG4gICAgLy8gUnVuIHRhc2tcbiAgICBfZ2V0RmFpbGVkVGVzdENvdW50ICh0YXNrLCByZXBvcnRlcikge1xuICAgICAgICBsZXQgZmFpbGVkVGVzdENvdW50ID0gcmVwb3J0ZXIudGVzdENvdW50IC0gcmVwb3J0ZXIucGFzc2VkO1xuXG4gICAgICAgIGlmICh0YXNrLm9wdHMuc3RvcE9uRmlyc3RGYWlsICYmICEhZmFpbGVkVGVzdENvdW50KVxuICAgICAgICAgICAgZmFpbGVkVGVzdENvdW50ID0gMTtcblxuICAgICAgICByZXR1cm4gZmFpbGVkVGVzdENvdW50O1xuICAgIH1cblxuICAgIGFzeW5jIF9nZXRUYXNrUmVzdWx0ICh0YXNrLCBicm93c2VyU2V0LCByZXBvcnRlcnMsIHRlc3RlZEFwcCkge1xuICAgICAgICB0YXNrLm9uKCdicm93c2VyLWpvYi1kb25lJywgam9iID0+IGJyb3dzZXJTZXQucmVsZWFzZUNvbm5lY3Rpb24oam9iLmJyb3dzZXJDb25uZWN0aW9uKSk7XG5cbiAgICAgICAgY29uc3QgYnJvd3NlclNldEVycm9yUHJvbWlzZSA9IHByb21pc2lmeUV2ZW50KGJyb3dzZXJTZXQsICdlcnJvcicpO1xuXG4gICAgICAgIGNvbnN0IHRhc2tEb25lUHJvbWlzZSA9IHRhc2sub25jZSgnZG9uZScpXG4gICAgICAgICAgICAudGhlbigoKSA9PiBicm93c2VyU2V0RXJyb3JQcm9taXNlLmNhbmNlbCgpKTtcblxuXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW1xuICAgICAgICAgICAgdGFza0RvbmVQcm9taXNlLFxuICAgICAgICAgICAgYnJvd3NlclNldEVycm9yUHJvbWlzZVxuICAgICAgICBdO1xuXG4gICAgICAgIGlmICh0ZXN0ZWRBcHApXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRlc3RlZEFwcC5lcnJvclByb21pc2UpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLnJhY2UocHJvbWlzZXMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2Rpc3Bvc2VUYXNrQW5kUmVsYXRlZEFzc2V0cyh0YXNrLCBicm93c2VyU2V0LCByZXBvcnRlcnMsIHRlc3RlZEFwcCk7XG5cbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHRoaXMuX2Rpc3Bvc2VBc3NldHMoYnJvd3NlclNldCwgcmVwb3J0ZXJzLCB0ZXN0ZWRBcHApO1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRGYWlsZWRUZXN0Q291bnQodGFzaywgcmVwb3J0ZXJzWzBdKTtcbiAgICB9XG5cbiAgICBfY3JlYXRlVGFzayAodGVzdHMsIGJyb3dzZXJDb25uZWN0aW9uR3JvdXBzLCBwcm94eSwgb3B0cykge1xuICAgICAgICByZXR1cm4gbmV3IFRhc2sodGVzdHMsIGJyb3dzZXJDb25uZWN0aW9uR3JvdXBzLCBwcm94eSwgb3B0cyk7XG4gICAgfVxuXG4gICAgX3J1blRhc2sgKHJlcG9ydGVyUGx1Z2lucywgYnJvd3NlclNldCwgdGVzdHMsIHRlc3RlZEFwcCkge1xuICAgICAgICBsZXQgY29tcGxldGVkICAgICAgICAgICA9IGZhbHNlO1xuICAgICAgICBjb25zdCB0YXNrICAgICAgICAgICAgICA9IHRoaXMuX2NyZWF0ZVRhc2sodGVzdHMsIGJyb3dzZXJTZXQuYnJvd3NlckNvbm5lY3Rpb25Hcm91cHMsIHRoaXMucHJveHksIHRoaXMuY29uZmlndXJhdGlvbi5nZXRPcHRpb25zKCkpO1xuICAgICAgICBjb25zdCByZXBvcnRlcnMgICAgICAgICA9IHJlcG9ydGVyUGx1Z2lucy5tYXAocmVwb3J0ZXIgPT4gbmV3IFJlcG9ydGVyKHJlcG9ydGVyLnBsdWdpbiwgdGFzaywgcmVwb3J0ZXIub3V0U3RyZWFtKSk7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRpb25Qcm9taXNlID0gdGhpcy5fZ2V0VGFza1Jlc3VsdCh0YXNrLCBicm93c2VyU2V0LCByZXBvcnRlcnMsIHRlc3RlZEFwcCk7XG5cbiAgICAgICAgdGFzay5vbignc3RhcnQnLCBzdGFydEhhbmRsaW5nVGVzdEVycm9ycyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5za2lwVW5jYXVnaHRFcnJvcnMpKSB7XG4gICAgICAgICAgICB0YXNrLm9uY2UoJ3Rlc3QtcnVuLXN0YXJ0JywgYWRkUnVubmluZ1Rlc3QpO1xuICAgICAgICAgICAgdGFzay5vbmNlKCd0ZXN0LXJ1bi1kb25lJywgcmVtb3ZlUnVubmluZ1Rlc3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFzay5vbignZG9uZScsIHN0b3BIYW5kbGluZ1Rlc3RFcnJvcnMpO1xuXG4gICAgICAgIGNvbnN0IHNldENvbXBsZXRlZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29tcGxldGlvblByb21pc2VcbiAgICAgICAgICAgIC50aGVuKHNldENvbXBsZXRlZClcbiAgICAgICAgICAgIC5jYXRjaChzZXRDb21wbGV0ZWQpO1xuXG4gICAgICAgIGNvbnN0IGNhbmNlbFRhc2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWNvbXBsZXRlZClcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9kaXNwb3NlVGFza0FuZFJlbGF0ZWRBc3NldHModGFzaywgYnJvd3NlclNldCwgcmVwb3J0ZXJzLCB0ZXN0ZWRBcHApO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7IGNvbXBsZXRpb25Qcm9taXNlLCBjYW5jZWxUYXNrIH07XG4gICAgfVxuXG4gICAgX3JlZ2lzdGVyQXNzZXRzIChhc3NldHMpIHtcbiAgICAgICAgYXNzZXRzLmZvckVhY2goYXNzZXQgPT4gdGhpcy5wcm94eS5HRVQoYXNzZXQucGF0aCwgYXNzZXQuaW5mbykpO1xuICAgIH1cblxuICAgIF92YWxpZGF0ZVNwZWVkT3B0aW9uICgpIHtcbiAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5zcGVlZCk7XG5cbiAgICAgICAgaWYgKHNwZWVkID09PSB2b2lkIDApXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgaWYgKHR5cGVvZiBzcGVlZCAhPT0gJ251bWJlcicgfHwgaXNOYU4oc3BlZWQpIHx8IHNwZWVkIDwgMC4wMSB8fCBzcGVlZCA+IDEpXG4gICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLmludmFsaWRTcGVlZFZhbHVlKTtcbiAgICB9XG5cbiAgICBfdmFsaWRhdGVDb25jdXJyZW5jeU9wdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGNvbmN1cnJlbmN5ID0gdGhpcy5jb25maWd1cmF0aW9uLmdldE9wdGlvbihPUFRJT05fTkFNRVMuY29uY3VycmVuY3kpO1xuXG4gICAgICAgIGlmIChjb25jdXJyZW5jeSA9PT0gdm9pZCAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0eXBlb2YgY29uY3VycmVuY3kgIT09ICdudW1iZXInIHx8IGlzTmFOKGNvbmN1cnJlbmN5KSB8fCBjb25jdXJyZW5jeSA8IDEpXG4gICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLmludmFsaWRDb25jdXJyZW5jeUZhY3Rvcik7XG4gICAgfVxuXG4gICAgX3ZhbGlkYXRlUHJveHlCeXBhc3NPcHRpb24gKCkge1xuICAgICAgICBsZXQgcHJveHlCeXBhc3MgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5wcm94eUJ5cGFzcyk7XG5cbiAgICAgICAgaWYgKHByb3h5QnlwYXNzID09PSB2b2lkIDApXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgYXNzZXJ0VHlwZShbIGlzLnN0cmluZywgaXMuYXJyYXkgXSwgbnVsbCwgJ1wicHJveHlCeXBhc3NcIiBhcmd1bWVudCcsIHByb3h5QnlwYXNzKTtcblxuICAgICAgICBpZiAodHlwZW9mIHByb3h5QnlwYXNzID09PSAnc3RyaW5nJylcbiAgICAgICAgICAgIHByb3h5QnlwYXNzID0gW3Byb3h5QnlwYXNzXTtcblxuICAgICAgICBwcm94eUJ5cGFzcyA9IHByb3h5QnlwYXNzLnJlZHVjZSgoYXJyLCBydWxlcykgPT4ge1xuICAgICAgICAgICAgYXNzZXJ0VHlwZShpcy5zdHJpbmcsIG51bGwsICdcInByb3h5QnlwYXNzXCIgYXJndW1lbnQnLCBydWxlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiBhcnIuY29uY2F0KHJ1bGVzLnNwbGl0KCcsJykpO1xuICAgICAgICB9LCBbXSk7XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7IHByb3h5QnlwYXNzIH0pO1xuICAgIH1cblxuICAgIF92YWxpZGF0ZVNjcmVlbnNob3RPcHRpb25zICgpIHtcbiAgICAgICAgY29uc3Qgc2NyZWVuc2hvdFBhdGggICAgICAgID0gdGhpcy5jb25maWd1cmF0aW9uLmdldE9wdGlvbihPUFRJT05fTkFNRVMuc2NyZWVuc2hvdFBhdGgpO1xuICAgICAgICBjb25zdCBzY3JlZW5zaG90UGF0aFBhdHRlcm4gPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5zY3JlZW5zaG90UGF0aFBhdHRlcm4pO1xuXG4gICAgICAgIGlmIChzY3JlZW5zaG90UGF0aCkge1xuICAgICAgICAgICAgdGhpcy5fdmFsaWRhdGVTY3JlZW5zaG90UGF0aChzY3JlZW5zaG90UGF0aCwgJ3NjcmVlbnNob3RzIGJhc2UgZGlyZWN0b3J5IHBhdGgnKTtcblxuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7IFtPUFRJT05fTkFNRVMuc2NyZWVuc2hvdFBhdGhdOiByZXNvbHZlUGF0aChzY3JlZW5zaG90UGF0aCkgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2NyZWVuc2hvdFBhdGhQYXR0ZXJuKVxuICAgICAgICAgICAgdGhpcy5fdmFsaWRhdGVTY3JlZW5zaG90UGF0aChzY3JlZW5zaG90UGF0aFBhdHRlcm4sICdzY3JlZW5zaG90cyBwYXRoIHBhdHRlcm4nKTtcblxuICAgICAgICBpZiAoIXNjcmVlbnNob3RQYXRoICYmIHNjcmVlbnNob3RQYXRoUGF0dGVybilcbiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXJyb3IoUlVOVElNRV9FUlJPUlMuY2Fubm90VXNlU2NyZWVuc2hvdFBhdGhQYXR0ZXJuV2l0aG91dEJhc2VTY3JlZW5zaG90UGF0aFNwZWNpZmllZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ZhbGlkYXRlVmlkZW9PcHRpb25zICgpIHtcbiAgICAgICAgY29uc3QgdmlkZW9QYXRoICAgICAgICAgICAgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy52aWRlb1BhdGgpO1xuICAgICAgICBjb25zdCB2aWRlb0VuY29kaW5nT3B0aW9ucyA9IHRoaXMuY29uZmlndXJhdGlvbi5nZXRPcHRpb24oT1BUSU9OX05BTUVTLnZpZGVvRW5jb2RpbmdPcHRpb25zKTtcblxuICAgICAgICBsZXQgdmlkZW9PcHRpb25zID0gdGhpcy5jb25maWd1cmF0aW9uLmdldE9wdGlvbihPUFRJT05fTkFNRVMudmlkZW9PcHRpb25zKTtcblxuICAgICAgICBpZiAoIXZpZGVvUGF0aCkge1xuICAgICAgICAgICAgaWYgKHZpZGVvT3B0aW9ucyB8fCB2aWRlb0VuY29kaW5nT3B0aW9ucylcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLmNhbm5vdFNldFZpZGVvT3B0aW9uc1dpdGhvdXRCYXNlVmlkZW9QYXRoU3BlY2lmaWVkKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7IFtPUFRJT05fTkFNRVMudmlkZW9QYXRoXTogcmVzb2x2ZVBhdGgodmlkZW9QYXRoKSB9KTtcblxuICAgICAgICBpZiAoIXZpZGVvT3B0aW9ucykge1xuICAgICAgICAgICAgdmlkZW9PcHRpb25zID0ge307XG5cbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXJnZU9wdGlvbnMoeyBbT1BUSU9OX05BTUVTLnZpZGVvT3B0aW9uc106IHZpZGVvT3B0aW9ucyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2aWRlb09wdGlvbnMuZmZtcGVnUGF0aClcbiAgICAgICAgICAgIHZpZGVvT3B0aW9ucy5mZm1wZWdQYXRoID0gcmVzb2x2ZVBhdGgodmlkZW9PcHRpb25zLmZmbXBlZ1BhdGgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB2aWRlb09wdGlvbnMuZmZtcGVnUGF0aCA9IGF3YWl0IGRldGVjdEZGTVBFRygpO1xuXG4gICAgICAgIGlmICghdmlkZW9PcHRpb25zLmZmbXBlZ1BhdGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLmNhbm5vdEZpbmRGRk1QRUcpO1xuICAgIH1cblxuICAgIGFzeW5jIF92YWxpZGF0ZVJ1bk9wdGlvbnMgKCkge1xuICAgICAgICB0aGlzLl92YWxpZGF0ZVNjcmVlbnNob3RPcHRpb25zKCk7XG4gICAgICAgIGF3YWl0IHRoaXMuX3ZhbGlkYXRlVmlkZW9PcHRpb25zKCk7XG4gICAgICAgIHRoaXMuX3ZhbGlkYXRlU3BlZWRPcHRpb24oKTtcbiAgICAgICAgdGhpcy5fdmFsaWRhdGVDb25jdXJyZW5jeU9wdGlvbigpO1xuICAgICAgICB0aGlzLl92YWxpZGF0ZVByb3h5QnlwYXNzT3B0aW9uKCk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZVJ1bm5hYmxlQ29uZmlndXJhdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvb3RzdHJhcHBlci5jcmVhdGVSdW5uYWJsZUNvbmZpZ3VyYXRpb24oKTtcbiAgICB9XG5cbiAgICBfdmFsaWRhdGVTY3JlZW5zaG90UGF0aCAoc2NyZWVuc2hvdFBhdGgsIHBhdGhUeXBlKSB7XG4gICAgICAgIGNvbnN0IGZvcmJpZGRlbkNoYXJzTGlzdCA9IGNoZWNrRmlsZVBhdGgoc2NyZWVuc2hvdFBhdGgpO1xuXG4gICAgICAgIGlmIChmb3JiaWRkZW5DaGFyc0xpc3QubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFcnJvcihSVU5USU1FX0VSUk9SUy5mb3JiaWRkZW5DaGFyYXRlcnNJblNjcmVlbnNob3RQYXRoLCBzY3JlZW5zaG90UGF0aCwgcGF0aFR5cGUsIHJlbmRlckZvcmJpZGRlbkNoYXJzTGlzdChmb3JiaWRkZW5DaGFyc0xpc3QpKTtcbiAgICB9XG5cbiAgICBfc2V0Qm9vdHN0cmFwcGVyT3B0aW9ucyAoKSB7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5wcmVwYXJlKCk7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5ub3RpZnlBYm91dE92ZXJyaWRlbk9wdGlvbnMoKTtcblxuICAgICAgICB0aGlzLmJvb3RzdHJhcHBlci5zb3VyY2VzICAgICAgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5zcmMpIHx8IHRoaXMuYm9vdHN0cmFwcGVyLnNvdXJjZXM7XG4gICAgICAgIHRoaXMuYm9vdHN0cmFwcGVyLmJyb3dzZXJzICAgICA9IHRoaXMuY29uZmlndXJhdGlvbi5nZXRPcHRpb24oT1BUSU9OX05BTUVTLmJyb3dzZXJzKSB8fCB0aGlzLmJvb3RzdHJhcHBlci5icm93c2VycztcbiAgICAgICAgdGhpcy5ib290c3RyYXBwZXIuY29uY3VycmVuY3kgID0gdGhpcy5jb25maWd1cmF0aW9uLmdldE9wdGlvbihPUFRJT05fTkFNRVMuY29uY3VycmVuY3kpO1xuICAgICAgICB0aGlzLmJvb3RzdHJhcHBlci5hcHBDb21tYW5kICAgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5hcHBDb21tYW5kKSB8fCB0aGlzLmJvb3RzdHJhcHBlci5hcHBDb21tYW5kO1xuICAgICAgICB0aGlzLmJvb3RzdHJhcHBlci5hcHBJbml0RGVsYXkgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5hcHBJbml0RGVsYXkpO1xuICAgICAgICB0aGlzLmJvb3RzdHJhcHBlci5maWx0ZXIgICAgICAgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0T3B0aW9uKE9QVElPTl9OQU1FUy5maWx0ZXIpIHx8IHRoaXMuYm9vdHN0cmFwcGVyLmZpbHRlcjtcbiAgICAgICAgdGhpcy5ib290c3RyYXBwZXIucmVwb3J0ZXJzICAgID0gdGhpcy5jb25maWd1cmF0aW9uLmdldE9wdGlvbihPUFRJT05fTkFNRVMucmVwb3J0ZXIpIHx8IHRoaXMuYm9vdHN0cmFwcGVyLnJlcG9ydGVycztcbiAgICB9XG5cbiAgICAvLyBBUElcbiAgICBlbWJlZGRpbmdPcHRpb25zIChvcHRzKSB7XG4gICAgICAgIGNvbnN0IHsgYXNzZXRzLCBUZXN0UnVuQ3RvciB9ID0gb3B0cztcblxuICAgICAgICB0aGlzLl9yZWdpc3RlckFzc2V0cyhhc3NldHMpO1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVyZ2VPcHRpb25zKHsgVGVzdFJ1bkN0b3IgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgc3JjICguLi5zb3VyY2VzKSB7XG4gICAgICAgIGlmICh0aGlzLmFwaU1ldGhvZFdhc0NhbGxlZC5zcmMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLm11bHRpcGxlQVBJTWV0aG9kQ2FsbEZvcmJpZGRlbiwgT1BUSU9OX05BTUVTLnNyYyk7XG5cbiAgICAgICAgc291cmNlcyA9IHRoaXMuX3ByZXBhcmVBcnJheVBhcmFtZXRlcihzb3VyY2VzKTtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7IFtPUFRJT05fTkFNRVMuc3JjXTogc291cmNlcyB9KTtcblxuICAgICAgICB0aGlzLmFwaU1ldGhvZFdhc0NhbGxlZC5zcmMgPSB0cnVlO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGJyb3dzZXJzICguLi5icm93c2Vycykge1xuICAgICAgICBpZiAodGhpcy5hcGlNZXRob2RXYXNDYWxsZWQuYnJvd3NlcnMpXG4gICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEVycm9yKFJVTlRJTUVfRVJST1JTLm11bHRpcGxlQVBJTWV0aG9kQ2FsbEZvcmJpZGRlbiwgT1BUSU9OX05BTUVTLmJyb3dzZXJzKTtcblxuICAgICAgICBicm93c2VycyA9IHRoaXMuX3ByZXBhcmVBcnJheVBhcmFtZXRlcihicm93c2Vycyk7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXJnZU9wdGlvbnMoeyBicm93c2VycyB9KTtcblxuICAgICAgICB0aGlzLmFwaU1ldGhvZFdhc0NhbGxlZC5icm93c2VycyA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY29uY3VycmVuY3kgKGNvbmN1cnJlbmN5KSB7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXJnZU9wdGlvbnMoeyBjb25jdXJyZW5jeSB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICByZXBvcnRlciAobmFtZSwgb3V0cHV0KSB7XG4gICAgICAgIGlmICh0aGlzLmFwaU1ldGhvZFdhc0NhbGxlZC5yZXBvcnRlcilcbiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXJyb3IoUlVOVElNRV9FUlJPUlMubXVsdGlwbGVBUElNZXRob2RDYWxsRm9yYmlkZGVuLCBPUFRJT05fTkFNRVMucmVwb3J0ZXIpO1xuXG4gICAgICAgIGxldCByZXBvcnRlcnMgPSBwcmVwYXJlUmVwb3J0ZXJzKG5hbWUsIG91dHB1dCk7XG5cbiAgICAgICAgcmVwb3J0ZXJzID0gdGhpcy5fcHJlcGFyZUFycmF5UGFyYW1ldGVyKHJlcG9ydGVycyk7XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7IFtPUFRJT05fTkFNRVMucmVwb3J0ZXJdOiByZXBvcnRlcnMgfSk7XG5cbiAgICAgICAgdGhpcy5hcGlNZXRob2RXYXNDYWxsZWQucmVwb3J0ZXIgPSB0cnVlO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGZpbHRlciAoZmlsdGVyKSB7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXJnZU9wdGlvbnMoeyBmaWx0ZXIgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgdXNlUHJveHkgKHByb3h5LCBwcm94eUJ5cGFzcykge1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVyZ2VPcHRpb25zKHsgcHJveHksIHByb3h5QnlwYXNzIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHNjcmVlbnNob3RzIChwYXRoLCB0YWtlT25GYWlscywgcGF0dGVybikge1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVyZ2VPcHRpb25zKHtcbiAgICAgICAgICAgIFtPUFRJT05fTkFNRVMuc2NyZWVuc2hvdFBhdGhdOiAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBbT1BUSU9OX05BTUVTLnRha2VTY3JlZW5zaG90c09uRmFpbHNdOiB0YWtlT25GYWlscyxcbiAgICAgICAgICAgIFtPUFRJT05fTkFNRVMuc2NyZWVuc2hvdFBhdGhQYXR0ZXJuXTogIHBhdHRlcm5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgdmlkZW8gKHBhdGgsIG9wdGlvbnMsIGVuY29kaW5nT3B0aW9ucykge1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVyZ2VPcHRpb25zKHtcbiAgICAgICAgICAgIFtPUFRJT05fTkFNRVMudmlkZW9QYXRoXTogICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgW09QVElPTl9OQU1FUy52aWRlb09wdGlvbnNdOiAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICBbT1BUSU9OX05BTUVTLnZpZGVvRW5jb2RpbmdPcHRpb25zXTogZW5jb2RpbmdPcHRpb25zXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHN0YXJ0QXBwIChjb21tYW5kLCBpbml0RGVsYXkpIHtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7XG4gICAgICAgICAgICBbT1BUSU9OX05BTUVTLmFwcENvbW1hbmRdOiAgIGNvbW1hbmQsXG4gICAgICAgICAgICBbT1BUSU9OX05BTUVTLmFwcEluaXREZWxheV06IGluaXREZWxheVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBydW4gKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLmFwaU1ldGhvZFdhc0NhbGxlZC5yZXNldCgpO1xuXG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIHNraXBKc0Vycm9ycyxcbiAgICAgICAgICAgIGRpc2FibGVQYWdlUmVsb2FkcyxcbiAgICAgICAgICAgIHF1YXJhbnRpbmVNb2RlLFxuICAgICAgICAgICAgZGVidWdNb2RlLFxuICAgICAgICAgICAgc2VsZWN0b3JUaW1lb3V0LFxuICAgICAgICAgICAgYXNzZXJ0aW9uVGltZW91dCxcbiAgICAgICAgICAgIHBhZ2VMb2FkVGltZW91dCxcbiAgICAgICAgICAgIHNwZWVkLFxuICAgICAgICAgICAgZGVidWdPbkZhaWwsXG4gICAgICAgICAgICBza2lwVW5jYXVnaHRFcnJvcnMsXG4gICAgICAgICAgICBzdG9wT25GaXJzdEZhaWxcbiAgICAgICAgfSA9IG9wdGlvbnM7XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lcmdlT3B0aW9ucyh7XG4gICAgICAgICAgICBza2lwSnNFcnJvcnM6ICAgICAgIHNraXBKc0Vycm9ycyxcbiAgICAgICAgICAgIGRpc2FibGVQYWdlUmVsb2FkczogZGlzYWJsZVBhZ2VSZWxvYWRzLFxuICAgICAgICAgICAgcXVhcmFudGluZU1vZGU6ICAgICBxdWFyYW50aW5lTW9kZSxcbiAgICAgICAgICAgIGRlYnVnTW9kZTogICAgICAgICAgZGVidWdNb2RlLFxuICAgICAgICAgICAgZGVidWdPbkZhaWw6ICAgICAgICBkZWJ1Z09uRmFpbCxcbiAgICAgICAgICAgIHNlbGVjdG9yVGltZW91dDogICAgc2VsZWN0b3JUaW1lb3V0LFxuICAgICAgICAgICAgYXNzZXJ0aW9uVGltZW91dDogICBhc3NlcnRpb25UaW1lb3V0LFxuICAgICAgICAgICAgcGFnZUxvYWRUaW1lb3V0OiAgICBwYWdlTG9hZFRpbWVvdXQsXG4gICAgICAgICAgICBzcGVlZDogICAgICAgICAgICAgIHNwZWVkLFxuICAgICAgICAgICAgc2tpcFVuY2F1Z2h0RXJyb3JzOiBza2lwVW5jYXVnaHRFcnJvcnMsXG4gICAgICAgICAgICBzdG9wT25GaXJzdEZhaWw6ICAgIHN0b3BPbkZpcnN0RmFpbFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9zZXRCb290c3RyYXBwZXJPcHRpb25zKCk7XG5cbiAgICAgICAgY29uc3QgcnVuVGFza1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5fdmFsaWRhdGVSdW5PcHRpb25zKCkpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLl9jcmVhdGVSdW5uYWJsZUNvbmZpZ3VyYXRpb24oKSlcbiAgICAgICAgICAgIC50aGVuKCh7IHJlcG9ydGVyUGx1Z2lucywgYnJvd3NlclNldCwgdGVzdHMsIHRlc3RlZEFwcCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkb25lLWJvb3RzdHJhcHBpbmcnKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW5UYXNrKHJlcG9ydGVyUGx1Z2lucywgYnJvd3NlclNldCwgdGVzdHMsIHRlc3RlZEFwcCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQ2FuY2VsYWJsZVByb21pc2UocnVuVGFza1Byb21pc2UpO1xuICAgIH1cblxuICAgIGFzeW5jIHN0b3AgKCkge1xuICAgICAgICAvLyBOT1RFOiBXaGVuIHRhc2tQcm9taXNlIGlzIGNhbmNlbGxlZCwgaXQgaXMgcmVtb3ZlZCBmcm9tXG4gICAgICAgIC8vIHRoZSBwZW5kaW5nVGFza1Byb21pc2VzIGFycmF5LCB3aGljaCBsZWFkcyB0byBzaGlmdGluZyBpbmRleGVzXG4gICAgICAgIC8vIHRvd2FyZHMgdGhlIGJlZ2lubmluZy4gU28sIHdlIG11c3QgY29weSB0aGUgYXJyYXkgaW4gb3JkZXIgdG8gaXRlcmF0ZSBpdCxcbiAgICAgICAgLy8gb3Igd2UgY2FuIHBlcmZvcm0gaXRlcmF0aW9uIGZyb20gdGhlIGVuZCB0byB0aGUgYmVnaW5uaW5nLlxuICAgICAgICBjb25zdCBjYW5jZWxsYXRpb25Qcm9taXNlcyA9IG1hcFJldmVyc2UodGhpcy5wZW5kaW5nVGFza1Byb21pc2VzLCB0YXNrUHJvbWlzZSA9PiB0YXNrUHJvbWlzZS5jYW5jZWwoKSk7XG5cbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoY2FuY2VsbGF0aW9uUHJvbWlzZXMpO1xuICAgIH1cbn1cbiJdfQ==
