'use strict';

exports.__esModule = true;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _from = require('babel-runtime/core-js/array/from');

var _from2 = _interopRequireDefault(_from);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _lodash = require('lodash');

var _readFileRelative = require('read-file-relative');

var _promisifyEvent = require('promisify-event');

var _promisifyEvent2 = _interopRequireDefault(_promisifyEvent);

var _pinkie = require('pinkie');

var _pinkie2 = _interopRequireDefault(_pinkie);

var _mustache = require('mustache');

var _mustache2 = _interopRequireDefault(_mustache);

var _asyncEventEmitter = require('../utils/async-event-emitter');

var _asyncEventEmitter2 = _interopRequireDefault(_asyncEventEmitter);

var _debugLogger = require('../notifications/debug-logger');

var _debugLogger2 = _interopRequireDefault(_debugLogger);

var _debugLog = require('./debug-log');

var _debugLog2 = _interopRequireDefault(_debugLog);

var _formattableAdapter = require('../errors/test-run/formattable-adapter');

var _formattableAdapter2 = _interopRequireDefault(_formattableAdapter);

var _errorList = require('../errors/error-list');

var _errorList2 = _interopRequireDefault(_errorList);

var _testRun = require('../errors/test-run/');

var _phase = require('./phase');

var _phase2 = _interopRequireDefault(_phase);

var _clientMessages = require('./client-messages');

var _clientMessages2 = _interopRequireDefault(_clientMessages);

var _type = require('./commands/type');

var _type2 = _interopRequireDefault(_type);

var _delay = require('../utils/delay');

var _delay2 = _interopRequireDefault(_delay);

var _markerSymbol = require('./marker-symbol');

var _markerSymbol2 = _interopRequireDefault(_markerSymbol);

var _testRunTracker = require('../api/test-run-tracker');

var _testRunTracker2 = _interopRequireDefault(_testRunTracker);

var _phase3 = require('../role/phase');

var _phase4 = _interopRequireDefault(_phase3);

var _pluginHost = require('../reporter/plugin-host');

var _pluginHost2 = _interopRequireDefault(_pluginHost);

var _browserConsoleMessages = require('./browser-console-messages');

var _browserConsoleMessages2 = _interopRequireDefault(_browserConsoleMessages);

var _unstableNetworkMode = require('../browser/connection/unstable-network-mode');

var _warningLog = require('../notifications/warning-log');

var _warningLog2 = _interopRequireDefault(_warningLog);

var _warningMessage = require('../notifications/warning-message');

var _warningMessage2 = _interopRequireDefault(_warningMessage);

var _utils = require('./commands/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const lazyRequire = require('import-lazy')(require);
const SessionController = lazyRequire('./session-controller');
const ClientFunctionBuilder = lazyRequire('../client-functions/client-function-builder');
const executeJsExpression = lazyRequire('./execute-js-expression');
const BrowserManipulationQueue = lazyRequire('./browser-manipulation-queue');
const TestRunBookmark = lazyRequire('./bookmark');
const AssertionExecutor = lazyRequire('../assertions/executor');
const actionCommands = lazyRequire('./commands/actions');
const browserManipulationCommands = lazyRequire('./commands/browser-manipulation');
const serviceCommands = lazyRequire('./commands/service');

const TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/index.js.mustache');
const IFRAME_TEST_RUN_TEMPLATE = (0, _readFileRelative.readSync)('../client/test-run/iframe.js.mustache');
const TEST_DONE_CONFIRMATION_RESPONSE = 'test-done-confirmation';
const MAX_RESPONSE_DELAY = 3000;

const ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT = 'all-driver-tasks-added-to-queue';

class TestRun extends _asyncEventEmitter2.default {
    constructor(test, browserConnection, screenshotCapturer, globalWarningLog, opts) {
        super();

        this[_markerSymbol2.default] = true;

        this.warningLog = new _warningLog2.default(globalWarningLog);

        this.opts = opts;
        this.test = test;
        this.browserConnection = browserConnection;

        this.phase = _phase2.default.initial;

        this.driverTaskQueue = [];
        this.testDoneCommandQueued = false;

        this.activeDialogHandler = null;
        this.activeIframeSelector = null;
        this.speed = this.opts.speed;
        this.pageLoadTimeout = this.opts.pageLoadTimeout;

        this.disablePageReloads = test.disablePageReloads || opts.disablePageReloads && test.disablePageReloads !== false;

        this.session = SessionController.getSession(this);

        this.consoleMessages = new _browserConsoleMessages2.default();

        this.pendingRequest = null;
        this.pendingPageError = null;

        this.controller = null;
        this.ctx = (0, _create2.default)(null);
        this.fixtureCtx = null;

        this.currentRoleId = null;
        this.usedRoleStates = (0, _create2.default)(null);

        this.errs = [];

        this.lastDriverStatusId = null;
        this.lastDriverStatusResponse = null;

        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        this.addingDriverTasksCount = 0;

        this.debugging = this.opts.debugMode;
        this.debugOnFail = this.opts.debugOnFail;
        this.disableDebugBreakpoints = false;
        this.debugReporterPluginHost = new _pluginHost2.default({ noColors: false });

        this.browserManipulationQueue = new BrowserManipulationQueue(browserConnection, screenshotCapturer, this.warningLog);

        this.debugLog = new _debugLog2.default(this.browserConnection.userAgent);

        this.quarantine = null;

        this.injectable.scripts.push('/testcafe-core.js');
        this.injectable.scripts.push('/testcafe-ui.js');
        this.injectable.scripts.push('/testcafe-automation.js');
        this.injectable.scripts.push('/testcafe-driver.js');
        this.injectable.styles.push('/testcafe-ui-styles.css');

        this.requestHooks = (0, _from2.default)(this.test.requestHooks);

        this._initRequestHooks();
    }

    get id() {
        return this.session.id;
    }

    get injectable() {
        return this.session.injectable;
    }

    addQuarantineInfo(quarantine) {
        this.quarantine = quarantine;
    }

    addRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) !== -1) return;

        this.requestHooks.push(hook);
        this._initRequestHook(hook);
    }

    removeRequestHook(hook) {
        if (this.requestHooks.indexOf(hook) === -1) return;

        (0, _lodash.pull)(this.requestHooks, hook);
        this._disposeRequestHook(hook);
    }

    _initRequestHook(hook) {
        hook.warningLog = this.warningLog;

        hook._instantiateRequestFilterRules();
        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.addRequestEventListeners(rule, {
                onRequest: hook.onRequest.bind(hook),
                onConfigureResponse: hook._onConfigureResponse.bind(hook),
                onResponse: hook.onResponse.bind(hook)
            });
        });
    }

    _disposeRequestHook(hook) {
        hook.warningLog = null;

        hook._instantiatedRequestFilterRules.forEach(rule => {
            this.session.removeRequestEventListeners(rule);
        });
    }

    _initRequestHooks() {
        this.requestHooks.forEach(hook => this._initRequestHook(hook));
    }

    // Hammerhead payload
    _getPayloadScript() {
        this.fileDownloadingHandled = false;
        this.resolveWaitForFileDownloadingPromise = null;

        return _mustache2.default.render(TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            browserId: (0, _stringify2.default)(this.browserConnection.id),
            browserHeartbeatRelativeUrl: (0, _stringify2.default)(this.browserConnection.heartbeatRelativeUrl),
            browserStatusRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusRelativeUrl),
            browserStatusDoneRelativeUrl: (0, _stringify2.default)(this.browserConnection.statusDoneRelativeUrl),
            userAgent: (0, _stringify2.default)(this.browserConnection.userAgent),
            testName: (0, _stringify2.default)(this.test.name),
            fixtureName: (0, _stringify2.default)(this.test.fixture.name),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            skipJsErrors: this.opts.skipJsErrors,
            retryTestPages: !!this.opts.retryTestPages,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    _getIframePayloadScript() {
        return _mustache2.default.render(IFRAME_TEST_RUN_TEMPLATE, {
            testRunId: (0, _stringify2.default)(this.session.id),
            selectorTimeout: this.opts.selectorTimeout,
            pageLoadTimeout: this.pageLoadTimeout,
            retryTestPages: !!this.opts.retryTestPages,
            speed: this.speed,
            dialogHandler: (0, _stringify2.default)(this.activeDialogHandler)
        });
    }

    // Hammerhead handlers
    getAuthCredentials() {
        return this.test.authCredentials;
    }

    handleFileDownload() {
        if (this.resolveWaitForFileDownloadingPromise) {
            this.resolveWaitForFileDownloadingPromise(true);
            this.resolveWaitForFileDownloadingPromise = null;
        } else this.fileDownloadingHandled = true;
    }

    handlePageError(ctx, err) {
        if (ctx.req.headers[_unstableNetworkMode.UNSTABLE_NETWORK_MODE_HEADER]) {
            ctx.closeWithError(500, err.toString());
            return;
        }

        this.pendingPageError = new _testRun.PageLoadError(err);

        ctx.redirect(ctx.toProxyUrl('about:error'));
    }

    // Test function execution
    _executeTestFn(phase, fn) {
        var _this = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this.phase = phase;

            try {
                yield fn(_this);
            } catch (err) {
                let screenshotPath = null;

                if (_this.opts.takeScreenshotsOnFails) screenshotPath = yield _this.executeCommand(new browserManipulationCommands.TakeScreenshotOnFailCommand());

                _this.addError(err, screenshotPath);
                return false;
            }

            return !_this._addPendingPageErrorIfAny();
        })();
    }

    _runBeforeHook() {
        var _this2 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this2.test.beforeFn) return yield _this2._executeTestFn(_phase2.default.inTestBeforeHook, _this2.test.beforeFn);

            if (_this2.test.fixture.beforeEachFn) return yield _this2._executeTestFn(_phase2.default.inFixtureBeforeEachHook, _this2.test.fixture.beforeEachFn);

            return true;
        })();
    }

    _runAfterHook() {
        var _this3 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this3.test.afterFn) return yield _this3._executeTestFn(_phase2.default.inTestAfterHook, _this3.test.afterFn);

            if (_this3.test.fixture.afterEachFn) return yield _this3._executeTestFn(_phase2.default.inFixtureAfterEachHook, _this3.test.fixture.afterEachFn);

            return true;
        })();
    }

    start() {
        var _this4 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _testRunTracker2.default.activeTestRuns[_this4.session.id] = _this4;

            yield _this4.emit('start');

            const onDisconnected = function onDisconnected(err) {
                return _this4._disconnect(err);
            };

            _this4.browserConnection.once('disconnected', onDisconnected);

            yield _this4.once('connected');

            yield _this4.emit('ready');

            if (yield _this4._runBeforeHook()) {
                yield _this4._executeTestFn(_phase2.default.inTest, _this4.test.fn);
                yield _this4._runAfterHook();
            }

            if (_this4.disconnected) return;

            _this4.browserConnection.removeListener('disconnected', onDisconnected);

            if (_this4.errs.length && _this4.debugOnFail) yield _this4._enqueueSetBreakpointCommand(null, _this4.debugReporterPluginHost.formatError(_this4.errs[0]));

            yield _this4.emit('before-done');

            yield _this4.executeCommand(new serviceCommands.TestDoneCommand());

            _this4._addPendingPageErrorIfAny();

            delete _testRunTracker2.default.activeTestRuns[_this4.session.id];

            yield _this4.emit('done');
        })();
    }

    // Errors
    _addPendingPageErrorIfAny() {
        if (this.pendingPageError) {
            this.addError(this.pendingPageError);
            this.pendingPageError = null;
            return true;
        }

        return false;
    }

    _createErrorAdapter(err, screenshotPath) {
        return new _formattableAdapter2.default(err, {
            userAgent: this.browserConnection.userAgent,
            screenshotPath: screenshotPath || '',
            testRunPhase: this.phase
        });
    }

    addError(err, screenshotPath) {
        const errList = err instanceof _errorList2.default ? err.items : [err];

        errList.forEach(item => {
            const adapter = this._createErrorAdapter(item, screenshotPath);

            this.errs.push(adapter);
        });
    }

    // Task queue
    _enqueueCommand(command, callsite) {
        var _this5 = this;

        if (this.pendingRequest) this._resolvePendingRequest(command);

        return new _pinkie2.default((() => {
            var _ref = (0, _asyncToGenerator3.default)(function* (resolve, reject) {
                _this5.addingDriverTasksCount--;
                _this5.driverTaskQueue.push({ command, resolve, reject, callsite });

                if (!_this5.addingDriverTasksCount) yield _this5.emit(ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT, _this5.driverTaskQueue.length);
            });

            return function (_x, _x2) {
                return _ref.apply(this, arguments);
            };
        })());
    }

    get driverTaskQueueLength() {
        return this.addingDriverTasksCount ? (0, _promisifyEvent2.default)(this, ALL_DRIVER_TASKS_ADDED_TO_QUEUE_EVENT) : _pinkie2.default.resolve(this.driverTaskQueue.length);
    }

    _enqueueBrowserConsoleMessagesCommand(command, callsite) {
        var _this6 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            yield _this6._enqueueCommand(command, callsite);

            return _this6.consoleMessages.getCopy();
        })();
    }

    _enqueueSetBreakpointCommand(callsite, error) {
        var _this7 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this7.browserConnection.isHeadlessBrowser()) {
                _this7.warningLog.addWarning(_warningMessage2.default.debugInHeadlessError);
                return;
            }

            _debugLogger2.default.showBreakpoint(_this7.session.id, _this7.browserConnection.userAgent, callsite, error);

            _this7.debugging = yield _this7.executeCommand(new serviceCommands.SetBreakpointCommand(!!error), callsite);
        })();
    }

    _removeAllNonServiceTasks() {
        this.driverTaskQueue = this.driverTaskQueue.filter(driverTask => (0, _utils.isServiceCommand)(driverTask.command));

        this.browserManipulationQueue.removeAllNonServiceManipulations();
    }

    // Current driver task
    get currentDriverTask() {
        return this.driverTaskQueue[0];
    }

    _resolveCurrentDriverTask(result) {
        this.currentDriverTask.resolve(result);
        this.driverTaskQueue.shift();

        if (this.testDoneCommandQueued) this._removeAllNonServiceTasks();
    }

    _rejectCurrentDriverTask(err) {
        err.callsite = err.callsite || this.currentDriverTask.callsite;
        err.isRejectedDriverTask = true;

        this.currentDriverTask.reject(err);
        this._removeAllNonServiceTasks();
    }

    // Pending request
    _clearPendingRequest() {
        if (this.pendingRequest) {
            clearTimeout(this.pendingRequest.responseTimeout);
            this.pendingRequest = null;
        }
    }

    _resolvePendingRequest(command) {
        this.lastDriverStatusResponse = command;
        this.pendingRequest.resolve(command);
        this._clearPendingRequest();
    }

    // Handle driver request
    _fulfillCurrentDriverTask(driverStatus) {
        if (driverStatus.executionError) this._rejectCurrentDriverTask(driverStatus.executionError);else this._resolveCurrentDriverTask(driverStatus.result);
    }

    _handlePageErrorStatus(pageError) {
        if (this.currentDriverTask && (0, _utils.isCommandRejectableByPageError)(this.currentDriverTask.command)) {
            this._rejectCurrentDriverTask(pageError);
            this.pendingPageError = null;

            return true;
        }

        this.pendingPageError = this.pendingPageError || pageError;

        return false;
    }

    _handleDriverRequest(driverStatus) {
        const isTestDone = this.currentDriverTask && this.currentDriverTask.command.type === _type2.default.testDone;
        const pageError = this.pendingPageError || driverStatus.pageError;
        const currentTaskRejectedByError = pageError && this._handlePageErrorStatus(pageError);

        if (this.disconnected) return new _pinkie2.default((_, reject) => reject());

        this.consoleMessages.concat(driverStatus.consoleMessages);

        if (!currentTaskRejectedByError && driverStatus.isCommandResult) {
            if (isTestDone) {
                this._resolveCurrentDriverTask();

                return TEST_DONE_CONFIRMATION_RESPONSE;
            }

            this._fulfillCurrentDriverTask(driverStatus);
        }

        return this._getCurrentDriverTaskCommand();
    }

    _getCurrentDriverTaskCommand() {
        if (!this.currentDriverTask) return null;

        const command = this.currentDriverTask.command;

        if (command.type === _type2.default.navigateTo && command.stateSnapshot) this.session.useStateSnapshot(JSON.parse(command.stateSnapshot));

        return command;
    }

    // Execute command
    _executeExpression(command) {
        var _this8 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const resultVariableName = command.resultVariableName,
                  isAsyncExpression = command.isAsyncExpression;


            let expression = command.expression;

            if (isAsyncExpression) expression = `await ${expression}`;

            if (resultVariableName) expression = `${resultVariableName} = ${expression}, ${resultVariableName}`;

            if (isAsyncExpression) expression = `(async () => { return ${expression}; }).apply(this);`;

            const result = executeJsExpression(expression, _this8, { skipVisibilityCheck: false });

            return isAsyncExpression ? yield result : result;
        })();
    }

    _executeAssertion(command, callsite) {
        var _this9 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const assertionTimeout = command.options.timeout === void 0 ? _this9.opts.assertionTimeout : command.options.timeout;
            const executor = new AssertionExecutor(command, assertionTimeout, callsite);

            executor.once('start-assertion-retries', function (timeout) {
                return _this9.executeCommand(new serviceCommands.ShowAssertionRetriesStatusCommand(timeout));
            });
            executor.once('end-assertion-retries', function (success) {
                return _this9.executeCommand(new serviceCommands.HideAssertionRetriesStatusCommand(success));
            });

            return executor.run();
        })();
    }

    _adjustConfigurationWithCommand(command) {
        if (command.type === _type2.default.testDone) {
            this.testDoneCommandQueued = true;
            _debugLogger2.default.hideBreakpoint(this.session.id);
        } else if (command.type === _type2.default.setNativeDialogHandler) this.activeDialogHandler = command.dialogHandler;else if (command.type === _type2.default.switchToIframe) this.activeIframeSelector = command.selector;else if (command.type === _type2.default.switchToMainWindow) this.activeIframeSelector = null;else if (command.type === _type2.default.setTestSpeed) this.speed = command.speed;else if (command.type === _type2.default.setPageLoadTimeout) this.pageLoadTimeout = command.duration;else if (command.type === _type2.default.debug) this.debugging = true;
    }

    _adjustScreenshotCommand(command) {
        var _this10 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const browserId = _this10.browserConnection.id;

            var _ref2 = yield _this10.browserConnection.provider.hasCustomActionForBrowser(browserId);

            const hasChromelessScreenshots = _ref2.hasChromelessScreenshots;


            if (!hasChromelessScreenshots) command.generateScreenshotMark();
        })();
    }

    _setBreakpointIfNecessary(command, callsite) {
        var _this11 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (!_this11.disableDebugBreakpoints && _this11.debugging && (0, _utils.canSetDebuggerBreakpointBeforeCommand)(command)) yield _this11._enqueueSetBreakpointCommand(callsite);
        })();
    }

    executeCommand(command, callsite) {
        var _this12 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this12.debugLog.command(command);

            if (_this12.pendingPageError && (0, _utils.isCommandRejectableByPageError)(command)) return _this12._rejectCommandWithPageError(callsite);

            if ((0, _utils.isExecutableOnClientCommand)(command)) _this12.addingDriverTasksCount++;

            _this12._adjustConfigurationWithCommand(command);

            yield _this12._setBreakpointIfNecessary(command, callsite);

            if ((0, _utils.isScreenshotCommand)(command)) yield _this12._adjustScreenshotCommand(command);

            if ((0, _utils.isBrowserManipulationCommand)(command)) _this12.browserManipulationQueue.push(command);

            if (command.type === _type2.default.wait) return (0, _delay2.default)(command.timeout);

            if (command.type === _type2.default.setPageLoadTimeout) return null;

            if (command.type === _type2.default.debug) return yield _this12._enqueueSetBreakpointCommand(callsite);

            if (command.type === _type2.default.useRole) return yield _this12._useRole(command.role, callsite);

            if (command.type === _type2.default.assertion) return _this12._executeAssertion(command, callsite);

            if (command.type === _type2.default.executeExpression) return yield _this12._executeExpression(command, callsite);

            if (command.type === _type2.default.getBrowserConsoleMessages) return yield _this12._enqueueBrowserConsoleMessagesCommand(command, callsite);

            return _this12._enqueueCommand(command, callsite);
        })();
    }

    _rejectCommandWithPageError(callsite) {
        const err = this.pendingPageError;

        err.callsite = callsite;
        this.pendingPageError = null;

        return _pinkie2.default.reject(err);
    }

    // Role management
    getStateSnapshot() {
        var _this13 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const state = _this13.session.getStateSnapshot();

            state.storages = yield _this13.executeCommand(new serviceCommands.BackupStoragesCommand());

            return state;
        })();
    }

    switchToCleanRun() {
        var _this14 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            _this14.ctx = (0, _create2.default)(null);
            _this14.fixtureCtx = (0, _create2.default)(null);
            _this14.consoleMessages = new _browserConsoleMessages2.default();

            _this14.session.useStateSnapshot(null);

            if (_this14.activeDialogHandler) {
                const removeDialogHandlerCommand = new actionCommands.SetNativeDialogHandlerCommand({ dialogHandler: { fn: null } });

                yield _this14.executeCommand(removeDialogHandlerCommand);
            }

            if (_this14.speed !== _this14.opts.speed) {
                const setSpeedCommand = new actionCommands.SetTestSpeedCommand({ speed: _this14.opts.speed });

                yield _this14.executeCommand(setSpeedCommand);
            }

            if (_this14.pageLoadTimeout !== _this14.opts.pageLoadTimeout) {
                const setPageLoadTimeoutCommand = new actionCommands.SetPageLoadTimeoutCommand({ duration: _this14.opts.pageLoadTimeout });

                yield _this14.executeCommand(setPageLoadTimeoutCommand);
            }
        })();
    }

    _getStateSnapshotFromRole(role) {
        var _this15 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const prevPhase = _this15.phase;

            _this15.phase = _phase2.default.inRoleInitializer;

            if (role.phase === _phase4.default.uninitialized) yield role.initialize(_this15);else if (role.phase === _phase4.default.pendingInitialization) yield (0, _promisifyEvent2.default)(role, 'initialized');

            if (role.initErr) throw role.initErr;

            _this15.phase = prevPhase;

            return role.stateSnapshot;
        })();
    }

    _useRole(role, callsite) {
        var _this16 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            if (_this16.phase === _phase2.default.inRoleInitializer) throw new _testRun.RoleSwitchInRoleInitializerError(callsite);

            _this16.disableDebugBreakpoints = true;

            const bookmark = new TestRunBookmark(_this16, role);

            yield bookmark.init();

            if (_this16.currentRoleId) _this16.usedRoleStates[_this16.currentRoleId] = yield _this16.getStateSnapshot();

            const stateSnapshot = _this16.usedRoleStates[role.id] || (yield _this16._getStateSnapshotFromRole(role));

            _this16.session.useStateSnapshot(stateSnapshot);

            _this16.currentRoleId = role.id;

            yield bookmark.restore(callsite, stateSnapshot);

            _this16.disableDebugBreakpoints = false;
        })();
    }

    // Get current URL
    getCurrentUrl() {
        var _this17 = this;

        return (0, _asyncToGenerator3.default)(function* () {
            const builder = new ClientFunctionBuilder(function () {
                /* eslint-disable no-undef */
                return window.location.href;
                /* eslint-enable no-undef */
            }, { boundTestRun: _this17 });

            const getLocation = builder.getFunction();

            return yield getLocation();
        })();
    }

    _disconnect(err) {
        this.disconnected = true;

        this._rejectCurrentDriverTask(err);

        this.emit('disconnected', err);

        delete _testRunTracker2.default.activeTestRuns[this.session.id];
    }
}

exports.default = TestRun; // Service message handlers

const ServiceMessages = TestRun.prototype;

// NOTE: this function is time-critical and must return ASAP to avoid client disconnection
ServiceMessages[_clientMessages2.default.ready] = function (msg) {
    this.debugLog.driverMessage(msg);

    this.emit('connected');

    this._clearPendingRequest();

    // NOTE: the driver sends the status for the second time if it didn't get a response at the
    // first try. This is possible when the page was unloaded after the driver sent the status.
    if (msg.status.id === this.lastDriverStatusId) return this.lastDriverStatusResponse;

    this.lastDriverStatusId = msg.status.id;
    this.lastDriverStatusResponse = this._handleDriverRequest(msg.status);

    if (this.lastDriverStatusResponse) return this.lastDriverStatusResponse;

    // NOTE: we send an empty response after the MAX_RESPONSE_DELAY timeout is exceeded to keep connection
    // with the client and prevent the response timeout exception on the client side
    const responseTimeout = setTimeout(() => this._resolvePendingRequest(null), MAX_RESPONSE_DELAY);

    return new _pinkie2.default((resolve, reject) => {
        this.pendingRequest = { resolve, reject, responseTimeout };
    });
};

ServiceMessages[_clientMessages2.default.readyForBrowserManipulation] = (() => {
    var _ref3 = (0, _asyncToGenerator3.default)(function* (msg) {
        this.debugLog.driverMessage(msg);

        let result = null;
        let error = null;

        try {
            result = yield this.browserManipulationQueue.executePendingManipulation(msg);
        } catch (err) {
            error = err;
        }

        return { result, error };
    });

    return function (_x3) {
        return _ref3.apply(this, arguments);
    };
})();

ServiceMessages[_clientMessages2.default.waitForFileDownload] = function (msg) {
    this.debugLog.driverMessage(msg);

    return new _pinkie2.default(resolve => {
        if (this.fileDownloadingHandled) {
            this.fileDownloadingHandled = false;
            resolve(true);
        } else this.resolveWaitForFileDownloadingPromise = resolve;
    });
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0LXJ1bi9pbmRleC5qcyJdLCJuYW1lcyI6WyJsYXp5UmVxdWlyZSIsInJlcXVpcmUiLCJTZXNzaW9uQ29udHJvbGxlciIsIkNsaWVudEZ1bmN0aW9uQnVpbGRlciIsImV4ZWN1dGVKc0V4cHJlc3Npb24iLCJCcm93c2VyTWFuaXB1bGF0aW9uUXVldWUiLCJUZXN0UnVuQm9va21hcmsiLCJBc3NlcnRpb25FeGVjdXRvciIsImFjdGlvbkNvbW1hbmRzIiwiYnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmRzIiwic2VydmljZUNvbW1hbmRzIiwiVEVTVF9SVU5fVEVNUExBVEUiLCJJRlJBTUVfVEVTVF9SVU5fVEVNUExBVEUiLCJURVNUX0RPTkVfQ09ORklSTUFUSU9OX1JFU1BPTlNFIiwiTUFYX1JFU1BPTlNFX0RFTEFZIiwiQUxMX0RSSVZFUl9UQVNLU19BRERFRF9UT19RVUVVRV9FVkVOVCIsIlRlc3RSdW4iLCJBc3luY0V2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidGVzdCIsImJyb3dzZXJDb25uZWN0aW9uIiwic2NyZWVuc2hvdENhcHR1cmVyIiwiZ2xvYmFsV2FybmluZ0xvZyIsIm9wdHMiLCJ0ZXN0UnVuTWFya2VyIiwid2FybmluZ0xvZyIsIldhcm5pbmdMb2ciLCJwaGFzZSIsIlBIQVNFIiwiaW5pdGlhbCIsImRyaXZlclRhc2tRdWV1ZSIsInRlc3REb25lQ29tbWFuZFF1ZXVlZCIsImFjdGl2ZURpYWxvZ0hhbmRsZXIiLCJhY3RpdmVJZnJhbWVTZWxlY3RvciIsInNwZWVkIiwicGFnZUxvYWRUaW1lb3V0IiwiZGlzYWJsZVBhZ2VSZWxvYWRzIiwic2Vzc2lvbiIsImdldFNlc3Npb24iLCJjb25zb2xlTWVzc2FnZXMiLCJCcm93c2VyQ29uc29sZU1lc3NhZ2VzIiwicGVuZGluZ1JlcXVlc3QiLCJwZW5kaW5nUGFnZUVycm9yIiwiY29udHJvbGxlciIsImN0eCIsImZpeHR1cmVDdHgiLCJjdXJyZW50Um9sZUlkIiwidXNlZFJvbGVTdGF0ZXMiLCJlcnJzIiwibGFzdERyaXZlclN0YXR1c0lkIiwibGFzdERyaXZlclN0YXR1c1Jlc3BvbnNlIiwiZmlsZURvd25sb2FkaW5nSGFuZGxlZCIsInJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSIsImFkZGluZ0RyaXZlclRhc2tzQ291bnQiLCJkZWJ1Z2dpbmciLCJkZWJ1Z01vZGUiLCJkZWJ1Z09uRmFpbCIsImRpc2FibGVEZWJ1Z0JyZWFrcG9pbnRzIiwiZGVidWdSZXBvcnRlclBsdWdpbkhvc3QiLCJSZXBvcnRlclBsdWdpbkhvc3QiLCJub0NvbG9ycyIsImJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZSIsImRlYnVnTG9nIiwiVGVzdFJ1bkRlYnVnTG9nIiwidXNlckFnZW50IiwicXVhcmFudGluZSIsImluamVjdGFibGUiLCJzY3JpcHRzIiwicHVzaCIsInN0eWxlcyIsInJlcXVlc3RIb29rcyIsIl9pbml0UmVxdWVzdEhvb2tzIiwiaWQiLCJhZGRRdWFyYW50aW5lSW5mbyIsImFkZFJlcXVlc3RIb29rIiwiaG9vayIsImluZGV4T2YiLCJfaW5pdFJlcXVlc3RIb29rIiwicmVtb3ZlUmVxdWVzdEhvb2siLCJfZGlzcG9zZVJlcXVlc3RIb29rIiwiX2luc3RhbnRpYXRlUmVxdWVzdEZpbHRlclJ1bGVzIiwiX2luc3RhbnRpYXRlZFJlcXVlc3RGaWx0ZXJSdWxlcyIsImZvckVhY2giLCJydWxlIiwiYWRkUmVxdWVzdEV2ZW50TGlzdGVuZXJzIiwib25SZXF1ZXN0IiwiYmluZCIsIm9uQ29uZmlndXJlUmVzcG9uc2UiLCJfb25Db25maWd1cmVSZXNwb25zZSIsIm9uUmVzcG9uc2UiLCJyZW1vdmVSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMiLCJfZ2V0UGF5bG9hZFNjcmlwdCIsIk11c3RhY2hlIiwicmVuZGVyIiwidGVzdFJ1bklkIiwiYnJvd3NlcklkIiwiYnJvd3NlckhlYXJ0YmVhdFJlbGF0aXZlVXJsIiwiaGVhcnRiZWF0UmVsYXRpdmVVcmwiLCJicm93c2VyU3RhdHVzUmVsYXRpdmVVcmwiLCJzdGF0dXNSZWxhdGl2ZVVybCIsImJyb3dzZXJTdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJzdGF0dXNEb25lUmVsYXRpdmVVcmwiLCJ0ZXN0TmFtZSIsIm5hbWUiLCJmaXh0dXJlTmFtZSIsImZpeHR1cmUiLCJzZWxlY3RvclRpbWVvdXQiLCJza2lwSnNFcnJvcnMiLCJyZXRyeVRlc3RQYWdlcyIsImRpYWxvZ0hhbmRsZXIiLCJfZ2V0SWZyYW1lUGF5bG9hZFNjcmlwdCIsImdldEF1dGhDcmVkZW50aWFscyIsImF1dGhDcmVkZW50aWFscyIsImhhbmRsZUZpbGVEb3dubG9hZCIsImhhbmRsZVBhZ2VFcnJvciIsImVyciIsInJlcSIsImhlYWRlcnMiLCJVTlNUQUJMRV9ORVRXT1JLX01PREVfSEVBREVSIiwiY2xvc2VXaXRoRXJyb3IiLCJ0b1N0cmluZyIsIlBhZ2VMb2FkRXJyb3IiLCJyZWRpcmVjdCIsInRvUHJveHlVcmwiLCJfZXhlY3V0ZVRlc3RGbiIsImZuIiwic2NyZWVuc2hvdFBhdGgiLCJ0YWtlU2NyZWVuc2hvdHNPbkZhaWxzIiwiZXhlY3V0ZUNvbW1hbmQiLCJUYWtlU2NyZWVuc2hvdE9uRmFpbENvbW1hbmQiLCJhZGRFcnJvciIsIl9hZGRQZW5kaW5nUGFnZUVycm9ySWZBbnkiLCJfcnVuQmVmb3JlSG9vayIsImJlZm9yZUZuIiwiaW5UZXN0QmVmb3JlSG9vayIsImJlZm9yZUVhY2hGbiIsImluRml4dHVyZUJlZm9yZUVhY2hIb29rIiwiX3J1bkFmdGVySG9vayIsImFmdGVyRm4iLCJpblRlc3RBZnRlckhvb2siLCJhZnRlckVhY2hGbiIsImluRml4dHVyZUFmdGVyRWFjaEhvb2siLCJzdGFydCIsInRlc3RSdW5UcmFja2VyIiwiYWN0aXZlVGVzdFJ1bnMiLCJlbWl0Iiwib25EaXNjb25uZWN0ZWQiLCJfZGlzY29ubmVjdCIsIm9uY2UiLCJpblRlc3QiLCJkaXNjb25uZWN0ZWQiLCJyZW1vdmVMaXN0ZW5lciIsImxlbmd0aCIsIl9lbnF1ZXVlU2V0QnJlYWtwb2ludENvbW1hbmQiLCJmb3JtYXRFcnJvciIsIlRlc3REb25lQ29tbWFuZCIsIl9jcmVhdGVFcnJvckFkYXB0ZXIiLCJUZXN0UnVuRXJyb3JGb3JtYXR0YWJsZUFkYXB0ZXIiLCJ0ZXN0UnVuUGhhc2UiLCJlcnJMaXN0IiwiVGVzdENhZmVFcnJvckxpc3QiLCJpdGVtcyIsIml0ZW0iLCJhZGFwdGVyIiwiX2VucXVldWVDb21tYW5kIiwiY29tbWFuZCIsImNhbGxzaXRlIiwiX3Jlc29sdmVQZW5kaW5nUmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZHJpdmVyVGFza1F1ZXVlTGVuZ3RoIiwiX2VucXVldWVCcm93c2VyQ29uc29sZU1lc3NhZ2VzQ29tbWFuZCIsImdldENvcHkiLCJlcnJvciIsImlzSGVhZGxlc3NCcm93c2VyIiwiYWRkV2FybmluZyIsIldBUk5JTkdfTUVTU0FHRSIsImRlYnVnSW5IZWFkbGVzc0Vycm9yIiwiZGVidWdMb2dnZXIiLCJzaG93QnJlYWtwb2ludCIsIlNldEJyZWFrcG9pbnRDb21tYW5kIiwiX3JlbW92ZUFsbE5vblNlcnZpY2VUYXNrcyIsImZpbHRlciIsImRyaXZlclRhc2siLCJyZW1vdmVBbGxOb25TZXJ2aWNlTWFuaXB1bGF0aW9ucyIsImN1cnJlbnREcml2ZXJUYXNrIiwiX3Jlc29sdmVDdXJyZW50RHJpdmVyVGFzayIsInJlc3VsdCIsInNoaWZ0IiwiX3JlamVjdEN1cnJlbnREcml2ZXJUYXNrIiwiaXNSZWplY3RlZERyaXZlclRhc2siLCJfY2xlYXJQZW5kaW5nUmVxdWVzdCIsImNsZWFyVGltZW91dCIsInJlc3BvbnNlVGltZW91dCIsIl9mdWxmaWxsQ3VycmVudERyaXZlclRhc2siLCJkcml2ZXJTdGF0dXMiLCJleGVjdXRpb25FcnJvciIsIl9oYW5kbGVQYWdlRXJyb3JTdGF0dXMiLCJwYWdlRXJyb3IiLCJfaGFuZGxlRHJpdmVyUmVxdWVzdCIsImlzVGVzdERvbmUiLCJ0eXBlIiwiQ09NTUFORF9UWVBFIiwidGVzdERvbmUiLCJjdXJyZW50VGFza1JlamVjdGVkQnlFcnJvciIsIl8iLCJjb25jYXQiLCJpc0NvbW1hbmRSZXN1bHQiLCJfZ2V0Q3VycmVudERyaXZlclRhc2tDb21tYW5kIiwibmF2aWdhdGVUbyIsInN0YXRlU25hcHNob3QiLCJ1c2VTdGF0ZVNuYXBzaG90IiwiSlNPTiIsInBhcnNlIiwiX2V4ZWN1dGVFeHByZXNzaW9uIiwicmVzdWx0VmFyaWFibGVOYW1lIiwiaXNBc3luY0V4cHJlc3Npb24iLCJleHByZXNzaW9uIiwic2tpcFZpc2liaWxpdHlDaGVjayIsIl9leGVjdXRlQXNzZXJ0aW9uIiwiYXNzZXJ0aW9uVGltZW91dCIsIm9wdGlvbnMiLCJ0aW1lb3V0IiwiZXhlY3V0b3IiLCJTaG93QXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQiLCJIaWRlQXNzZXJ0aW9uUmV0cmllc1N0YXR1c0NvbW1hbmQiLCJzdWNjZXNzIiwicnVuIiwiX2FkanVzdENvbmZpZ3VyYXRpb25XaXRoQ29tbWFuZCIsImhpZGVCcmVha3BvaW50Iiwic2V0TmF0aXZlRGlhbG9nSGFuZGxlciIsInN3aXRjaFRvSWZyYW1lIiwic2VsZWN0b3IiLCJzd2l0Y2hUb01haW5XaW5kb3ciLCJzZXRUZXN0U3BlZWQiLCJzZXRQYWdlTG9hZFRpbWVvdXQiLCJkdXJhdGlvbiIsImRlYnVnIiwiX2FkanVzdFNjcmVlbnNob3RDb21tYW5kIiwicHJvdmlkZXIiLCJoYXNDdXN0b21BY3Rpb25Gb3JCcm93c2VyIiwiaGFzQ2hyb21lbGVzc1NjcmVlbnNob3RzIiwiZ2VuZXJhdGVTY3JlZW5zaG90TWFyayIsIl9zZXRCcmVha3BvaW50SWZOZWNlc3NhcnkiLCJfcmVqZWN0Q29tbWFuZFdpdGhQYWdlRXJyb3IiLCJ3YWl0IiwidXNlUm9sZSIsIl91c2VSb2xlIiwicm9sZSIsImFzc2VydGlvbiIsImV4ZWN1dGVFeHByZXNzaW9uIiwiZ2V0QnJvd3NlckNvbnNvbGVNZXNzYWdlcyIsImdldFN0YXRlU25hcHNob3QiLCJzdGF0ZSIsInN0b3JhZ2VzIiwiQmFja3VwU3RvcmFnZXNDb21tYW5kIiwic3dpdGNoVG9DbGVhblJ1biIsInJlbW92ZURpYWxvZ0hhbmRsZXJDb21tYW5kIiwiU2V0TmF0aXZlRGlhbG9nSGFuZGxlckNvbW1hbmQiLCJzZXRTcGVlZENvbW1hbmQiLCJTZXRUZXN0U3BlZWRDb21tYW5kIiwic2V0UGFnZUxvYWRUaW1lb3V0Q29tbWFuZCIsIlNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQiLCJfZ2V0U3RhdGVTbmFwc2hvdEZyb21Sb2xlIiwicHJldlBoYXNlIiwiaW5Sb2xlSW5pdGlhbGl6ZXIiLCJST0xFX1BIQVNFIiwidW5pbml0aWFsaXplZCIsImluaXRpYWxpemUiLCJwZW5kaW5nSW5pdGlhbGl6YXRpb24iLCJpbml0RXJyIiwiUm9sZVN3aXRjaEluUm9sZUluaXRpYWxpemVyRXJyb3IiLCJib29rbWFyayIsImluaXQiLCJyZXN0b3JlIiwiZ2V0Q3VycmVudFVybCIsImJ1aWxkZXIiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJib3VuZFRlc3RSdW4iLCJnZXRMb2NhdGlvbiIsImdldEZ1bmN0aW9uIiwiU2VydmljZU1lc3NhZ2VzIiwicHJvdG90eXBlIiwiQ0xJRU5UX01FU1NBR0VTIiwicmVhZHkiLCJtc2ciLCJkcml2ZXJNZXNzYWdlIiwic3RhdHVzIiwic2V0VGltZW91dCIsInJlYWR5Rm9yQnJvd3Nlck1hbmlwdWxhdGlvbiIsImV4ZWN1dGVQZW5kaW5nTWFuaXB1bGF0aW9uIiwid2FpdEZvckZpbGVEb3dubG9hZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOzs7O0FBU0EsTUFBTUEsY0FB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QVAsRUFBWTtBQUNSMkQsb0JBQVEzRCxHQUFSO0FBQ0g7O0FBRUQsZUFBTyxFQUFFeUUsTUFBRixFQUFVZCxLQUFWLEVBQVA7QUFDSCxLQWREOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQWdCQThHLGdCQUFnQkUseUJBQWdCUSxtQkFBaEMsSUFBdUQsVUFBVU4sR0FBVixFQUFlO0FBQ2xFLFNBQUtsTyxRQUFMLENBQWNtTyxhQUFkLENBQTRCRCxHQUE1Qjs7QUFFQSxXQUFPLElBQUl4SCxnQkFBSixDQUFZQyxXQUFXO0FBQzFCLFlBQUksS0FBS3RILHNCQUFULEVBQWlDO0FBQzdCLGlCQUFLQSxzQkFBTCxHQUE4QixLQUE5QjtBQUNBc0gsb0JBQVEsSUFBUjtBQUNILFNBSEQsTUFLSSxLQUFLckgsb0NBQUwsR0FBNENxSCxPQUE1QztBQUNQLEtBUE0sQ0FBUDtBQVFILENBWEQiLCJmaWxlIjoidGVzdC1ydW4vaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwdWxsIGFzIHJlbW92ZSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZWFkU3luYyBhcyByZWFkIH0gZnJvbSAncmVhZC1maWxlLXJlbGF0aXZlJztcbmltcG9ydCBwcm9taXNpZnlFdmVudCBmcm9tICdwcm9taXNpZnktZXZlbnQnO1xuaW1wb3J0IFByb21pc2UgZnJvbSAncGlua2llJztcbmltcG9ydCBNdXN0YWNoZSBmcm9tICdtdXN0YWNoZSc7XG5pbXBvcnQgQXN5bmNFdmVudEVtaXR0ZXIgZnJvbSAnLi4vdXRpbHMvYXN5bmMtZXZlbnQtZW1pdHRlcic7XG5pbXBvcnQgZGVidWdMb2dnZXIgZnJvbSAnLi4vbm90aWZpY2F0aW9ucy9kZWJ1Zy1sb2dnZXInO1xuaW1wb3J0IFRlc3RSdW5EZWJ1Z0xvZyBmcm9tICcuL2RlYnVnLWxvZyc7XG5pbXBvcnQgVGVzdFJ1bkVycm9yRm9ybWF0dGFibGVBZGFwdGVyIGZyb20gJy4uL2Vycm9ycy90ZXN0LXJ1bi9mb3JtYXR0YWJsZS1hZGFwdGVyJztcbmltcG9ydCBUZXN0Q2FmZUVycm9yTGlzdCBmcm9tICcuLi9lcnJvcnMvZXJyb3ItbGlzdCc7XG5pbXBvcnQgeyBQYWdlTG9hZEVycm9yLCBSb2xlU3dpdGNoSW5Sb2xlSW5pdGlhbGl6ZXJFcnJvciB9IGZyb20gJy4uL2Vycm9ycy90ZXN0LXJ1bi8nO1xuaW1wb3J0IFBIQVNFIGZyb20gJy4vcGhhc2UnO1xuaW1wb3J0IENMSUVOVF9NRVNTQUdFUyBmcm9tICcuL2NsaWVudC1tZXNzYWdlcyc7XG5pbXBvcnQgQ09NTUFORF9UWVBFIGZyb20gJy4vY29tbWFuZHMvdHlwZSc7XG5pbXBvcnQgZGVsYXkgZnJvbSAnLi4vdXRpbHMvZGVsYXknO1xuaW1wb3J0IHRlc3RSdW5NYXJrZXIgZnJvbSAnLi9tYXJrZXItc3ltYm9sJztcbmltcG9ydCB0ZXN0UnVuVHJhY2tlciBmcm9tICcuLi9hcGkvdGVzdC1ydW4tdHJhY2tlcic7XG5pbXBvcnQgUk9MRV9QSEFTRSBmcm9tICcuLi9yb2xlL3BoYXNlJztcbmltcG9ydCBSZXBvcnRlclBsdWdpbkhvc3QgZnJvbSAnLi4vcmVwb3J0ZXIvcGx1Z2luLWhvc3QnO1xuaW1wb3J0IEJyb3dzZXJDb25zb2xlTWVzc2FnZXMgZnJvbSAnLi9icm93c2VyLWNvbnNvbGUtbWVzc2FnZXMnO1xuaW1wb3J0IHsgVU5TVEFCTEVfTkVUV09SS19NT0RFX0hFQURFUiB9IGZyb20gJy4uL2Jyb3dzZXIvY29ubmVjdGlvbi91bnN0YWJsZS1uZXR3b3JrLW1vZGUnO1xuaW1wb3J0IFdhcm5pbmdMb2cgZnJvbSAnLi4vbm90aWZpY2F0aW9ucy93YXJuaW5nLWxvZyc7XG5pbXBvcnQgV0FSTklOR19NRVNTQUdFIGZyb20gJy4uL25vdGlmaWNhdGlvbnMvd2FybmluZy1tZXNzYWdlJztcblxuaW1wb3J0IHtcbiAgICBpc0NvbW1hbmRSZWplY3RhYmxlQnlQYWdlRXJyb3IsXG4gICAgaXNCcm93c2VyTWFuaXB1bGF0aW9uQ29tbWFuZCxcbiAgICBpc1NjcmVlbnNob3RDb21tYW5kLFxuICAgIGlzU2VydmljZUNvbW1hbmQsXG4gICAgY2FuU2V0RGVidWdnZXJCcmVha3BvaW50QmVmb3JlQ29tbWFuZCxcbiAgICBpc0V4ZWN1dGFibGVPbkNsaWVudENvbW1hbmRcbn0gZnJvbSAnLi9jb21tYW5kcy91dGlscyc7XG5cbmNvbnN0IGxhenlSZXF1aXJlICAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJ2ltcG9ydC1sYXp5JykocmVxdWlyZSk7XG5jb25zdCBTZXNzaW9uQ29udHJvbGxlciAgICAgICAgICAgPSBsYXp5UmVxdWlyZSgnLi9zZXNzaW9uLWNvbnRyb2xsZXInKTtcbmNvbnN0IENsaWVudEZ1bmN0aW9uQnVpbGRlciAgICAgICA9IGxhenlSZXF1aXJlKCcuLi9jbGllbnQtZnVuY3Rpb25zL2NsaWVudC1mdW5jdGlvbi1idWlsZGVyJyk7XG5jb25zdCBleGVjdXRlSnNFeHByZXNzaW9uICAgICAgICAgPSBsYXp5UmVxdWlyZSgnLi9leGVjdXRlLWpzLWV4cHJlc3Npb24nKTtcbmNvbnN0IEJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZSAgICA9IGxhenlSZXF1aXJlKCcuL2Jyb3dzZXItbWFuaXB1bGF0aW9uLXF1ZXVlJyk7XG5jb25zdCBUZXN0UnVuQm9va21hcmsgICAgICAgICAgICAgPSBsYXp5UmVxdWlyZSgnLi9ib29rbWFyaycpO1xuY29uc3QgQXNzZXJ0aW9uRXhlY3V0b3IgICAgICAgICAgID0gbGF6eVJlcXVpcmUoJy4uL2Fzc2VydGlvbnMvZXhlY3V0b3InKTtcbmNvbnN0IGFjdGlvbkNvbW1hbmRzICAgICAgICAgICAgICA9IGxhenlSZXF1aXJlKCcuL2NvbW1hbmRzL2FjdGlvbnMnKTtcbmNvbnN0IGJyb3dzZXJNYW5pcHVsYXRpb25Db21tYW5kcyA9IGxhenlSZXF1aXJlKCcuL2NvbW1hbmRzL2Jyb3dzZXItbWFuaXB1bGF0aW9uJyk7XG5jb25zdCBzZXJ2aWNlQ29tbWFuZHMgICAgICAgICAgICAgPSBsYXp5UmVxdWlyZSgnLi9jb21tYW5kcy9zZXJ2aWNlJyk7XG5cblxuY29uc3QgVEVTVF9SVU5fVEVNUExBVEUgICAgICAgICAgICAgICA9IHJlYWQoJy4uL2NsaWVudC90ZXN0LXJ1bi9pbmRleC5qcy5tdXN0YWNoZScpO1xuY29uc3QgSUZSQU1FX1RFU1RfUlVOX1RFTVBMQVRFICAgICAgICA9IHJlYWQoJy4uL2NsaWVudC90ZXN0LXJ1bi9pZnJhbWUuanMubXVzdGFjaGUnKTtcbmNvbnN0IFRFU1RfRE9ORV9DT05GSVJNQVRJT05fUkVTUE9OU0UgPSAndGVzdC1kb25lLWNvbmZpcm1hdGlvbic7XG5jb25zdCBNQVhfUkVTUE9OU0VfREVMQVkgICAgICAgICAgICAgID0gMzAwMDtcblxuY29uc3QgQUxMX0RSSVZFUl9UQVNLU19BRERFRF9UT19RVUVVRV9FVkVOVCA9ICdhbGwtZHJpdmVyLXRhc2tzLWFkZGVkLXRvLXF1ZXVlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVzdFJ1biBleHRlbmRzIEFzeW5jRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvciAodGVzdCwgYnJvd3NlckNvbm5lY3Rpb24sIHNjcmVlbnNob3RDYXB0dXJlciwgZ2xvYmFsV2FybmluZ0xvZywgb3B0cykge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXNbdGVzdFJ1bk1hcmtlcl0gPSB0cnVlO1xuXG4gICAgICAgIHRoaXMud2FybmluZ0xvZyA9IG5ldyBXYXJuaW5nTG9nKGdsb2JhbFdhcm5pbmdMb2cpO1xuXG4gICAgICAgIHRoaXMub3B0cyAgICAgICAgICAgICAgPSBvcHRzO1xuICAgICAgICB0aGlzLnRlc3QgICAgICAgICAgICAgID0gdGVzdDtcbiAgICAgICAgdGhpcy5icm93c2VyQ29ubmVjdGlvbiA9IGJyb3dzZXJDb25uZWN0aW9uO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSBQSEFTRS5pbml0aWFsO1xuXG4gICAgICAgIHRoaXMuZHJpdmVyVGFza1F1ZXVlICAgICAgID0gW107XG4gICAgICAgIHRoaXMudGVzdERvbmVDb21tYW5kUXVldWVkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5hY3RpdmVEaWFsb2dIYW5kbGVyICA9IG51bGw7XG4gICAgICAgIHRoaXMuYWN0aXZlSWZyYW1lU2VsZWN0b3IgPSBudWxsO1xuICAgICAgICB0aGlzLnNwZWVkICAgICAgICAgICAgICAgID0gdGhpcy5vcHRzLnNwZWVkO1xuICAgICAgICB0aGlzLnBhZ2VMb2FkVGltZW91dCAgICAgID0gdGhpcy5vcHRzLnBhZ2VMb2FkVGltZW91dDtcblxuICAgICAgICB0aGlzLmRpc2FibGVQYWdlUmVsb2FkcyA9IHRlc3QuZGlzYWJsZVBhZ2VSZWxvYWRzIHx8IG9wdHMuZGlzYWJsZVBhZ2VSZWxvYWRzICYmIHRlc3QuZGlzYWJsZVBhZ2VSZWxvYWRzICE9PSBmYWxzZTtcblxuICAgICAgICB0aGlzLnNlc3Npb24gPSBTZXNzaW9uQ29udHJvbGxlci5nZXRTZXNzaW9uKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuY29uc29sZU1lc3NhZ2VzID0gbmV3IEJyb3dzZXJDb25zb2xlTWVzc2FnZXMoKTtcblxuICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0ICAgPSBudWxsO1xuICAgICAgICB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIHRoaXMuY3R4ICAgICAgICA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIHRoaXMuZml4dHVyZUN0eCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50Um9sZUlkICA9IG51bGw7XG4gICAgICAgIHRoaXMudXNlZFJvbGVTdGF0ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgICAgIHRoaXMuZXJycyA9IFtdO1xuXG4gICAgICAgIHRoaXMubGFzdERyaXZlclN0YXR1c0lkICAgICAgID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2UgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuZmlsZURvd25sb2FkaW5nSGFuZGxlZCAgICAgICAgICAgICAgID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVzb2x2ZVdhaXRGb3JGaWxlRG93bmxvYWRpbmdQcm9taXNlID0gbnVsbDtcblxuICAgICAgICB0aGlzLmFkZGluZ0RyaXZlclRhc2tzQ291bnQgPSAwO1xuXG4gICAgICAgIHRoaXMuZGVidWdnaW5nICAgICAgICAgICAgICAgPSB0aGlzLm9wdHMuZGVidWdNb2RlO1xuICAgICAgICB0aGlzLmRlYnVnT25GYWlsICAgICAgICAgICAgID0gdGhpcy5vcHRzLmRlYnVnT25GYWlsO1xuICAgICAgICB0aGlzLmRpc2FibGVEZWJ1Z0JyZWFrcG9pbnRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGVidWdSZXBvcnRlclBsdWdpbkhvc3QgPSBuZXcgUmVwb3J0ZXJQbHVnaW5Ib3N0KHsgbm9Db2xvcnM6IGZhbHNlIH0pO1xuXG4gICAgICAgIHRoaXMuYnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlID0gbmV3IEJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZShicm93c2VyQ29ubmVjdGlvbiwgc2NyZWVuc2hvdENhcHR1cmVyLCB0aGlzLndhcm5pbmdMb2cpO1xuXG4gICAgICAgIHRoaXMuZGVidWdMb2cgPSBuZXcgVGVzdFJ1bkRlYnVnTG9nKHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50KTtcblxuICAgICAgICB0aGlzLnF1YXJhbnRpbmUgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS1jb3JlLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zY3JpcHRzLnB1c2goJy90ZXN0Y2FmZS11aS5qcycpO1xuICAgICAgICB0aGlzLmluamVjdGFibGUuc2NyaXB0cy5wdXNoKCcvdGVzdGNhZmUtYXV0b21hdGlvbi5qcycpO1xuICAgICAgICB0aGlzLmluamVjdGFibGUuc2NyaXB0cy5wdXNoKCcvdGVzdGNhZmUtZHJpdmVyLmpzJyk7XG4gICAgICAgIHRoaXMuaW5qZWN0YWJsZS5zdHlsZXMucHVzaCgnL3Rlc3RjYWZlLXVpLXN0eWxlcy5jc3MnKTtcblxuICAgICAgICB0aGlzLnJlcXVlc3RIb29rcyA9IEFycmF5LmZyb20odGhpcy50ZXN0LnJlcXVlc3RIb29rcyk7XG5cbiAgICAgICAgdGhpcy5faW5pdFJlcXVlc3RIb29rcygpO1xuICAgIH1cblxuICAgIGdldCBpZCAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24uaWQ7XG4gICAgfVxuXG4gICAgZ2V0IGluamVjdGFibGUgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uLmluamVjdGFibGU7XG4gICAgfVxuXG4gICAgYWRkUXVhcmFudGluZUluZm8gKHF1YXJhbnRpbmUpIHtcbiAgICAgICAgdGhpcy5xdWFyYW50aW5lID0gcXVhcmFudGluZTtcbiAgICB9XG5cbiAgICBhZGRSZXF1ZXN0SG9vayAoaG9vaykge1xuICAgICAgICBpZiAodGhpcy5yZXF1ZXN0SG9va3MuaW5kZXhPZihob29rKSAhPT0gLTEpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdGhpcy5yZXF1ZXN0SG9va3MucHVzaChob29rKTtcbiAgICAgICAgdGhpcy5faW5pdFJlcXVlc3RIb29rKGhvb2spO1xuICAgIH1cblxuICAgIHJlbW92ZVJlcXVlc3RIb29rIChob29rKSB7XG4gICAgICAgIGlmICh0aGlzLnJlcXVlc3RIb29rcy5pbmRleE9mKGhvb2spID09PSAtMSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICByZW1vdmUodGhpcy5yZXF1ZXN0SG9va3MsIGhvb2spO1xuICAgICAgICB0aGlzLl9kaXNwb3NlUmVxdWVzdEhvb2soaG9vayk7XG4gICAgfVxuXG4gICAgX2luaXRSZXF1ZXN0SG9vayAoaG9vaykge1xuICAgICAgICBob29rLndhcm5pbmdMb2cgPSB0aGlzLndhcm5pbmdMb2c7XG5cbiAgICAgICAgaG9vay5faW5zdGFudGlhdGVSZXF1ZXN0RmlsdGVyUnVsZXMoKTtcbiAgICAgICAgaG9vay5faW5zdGFudGlhdGVkUmVxdWVzdEZpbHRlclJ1bGVzLmZvckVhY2gocnVsZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb24uYWRkUmVxdWVzdEV2ZW50TGlzdGVuZXJzKHJ1bGUsIHtcbiAgICAgICAgICAgICAgICBvblJlcXVlc3Q6ICAgICAgICAgICBob29rLm9uUmVxdWVzdC5iaW5kKGhvb2spLFxuICAgICAgICAgICAgICAgIG9uQ29uZmlndXJlUmVzcG9uc2U6IGhvb2suX29uQ29uZmlndXJlUmVzcG9uc2UuYmluZChob29rKSxcbiAgICAgICAgICAgICAgICBvblJlc3BvbnNlOiAgICAgICAgICBob29rLm9uUmVzcG9uc2UuYmluZChob29rKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9kaXNwb3NlUmVxdWVzdEhvb2sgKGhvb2spIHtcbiAgICAgICAgaG9vay53YXJuaW5nTG9nID0gbnVsbDtcblxuICAgICAgICBob29rLl9pbnN0YW50aWF0ZWRSZXF1ZXN0RmlsdGVyUnVsZXMuZm9yRWFjaChydWxlID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5yZW1vdmVSZXF1ZXN0RXZlbnRMaXN0ZW5lcnMocnVsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9pbml0UmVxdWVzdEhvb2tzICgpIHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0SG9va3MuZm9yRWFjaChob29rID0+IHRoaXMuX2luaXRSZXF1ZXN0SG9vayhob29rKSk7XG4gICAgfVxuXG4gICAgLy8gSGFtbWVyaGVhZCBwYXlsb2FkXG4gICAgX2dldFBheWxvYWRTY3JpcHQgKCkge1xuICAgICAgICB0aGlzLmZpbGVEb3dubG9hZGluZ0hhbmRsZWQgICAgICAgICAgICAgICA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSA9IG51bGw7XG5cbiAgICAgICAgcmV0dXJuIE11c3RhY2hlLnJlbmRlcihURVNUX1JVTl9URU1QTEFURSwge1xuICAgICAgICAgICAgdGVzdFJ1bklkOiAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5zZXNzaW9uLmlkKSxcbiAgICAgICAgICAgIGJyb3dzZXJJZDogICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuYnJvd3NlckNvbm5lY3Rpb24uaWQpLFxuICAgICAgICAgICAgYnJvd3NlckhlYXJ0YmVhdFJlbGF0aXZlVXJsOiAgSlNPTi5zdHJpbmdpZnkodGhpcy5icm93c2VyQ29ubmVjdGlvbi5oZWFydGJlYXRSZWxhdGl2ZVVybCksXG4gICAgICAgICAgICBicm93c2VyU3RhdHVzUmVsYXRpdmVVcmw6ICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmJyb3dzZXJDb25uZWN0aW9uLnN0YXR1c1JlbGF0aXZlVXJsKSxcbiAgICAgICAgICAgIGJyb3dzZXJTdGF0dXNEb25lUmVsYXRpdmVVcmw6IEpTT04uc3RyaW5naWZ5KHRoaXMuYnJvd3NlckNvbm5lY3Rpb24uc3RhdHVzRG9uZVJlbGF0aXZlVXJsKSxcbiAgICAgICAgICAgIHVzZXJBZ2VudDogICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50KSxcbiAgICAgICAgICAgIHRlc3ROYW1lOiAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMudGVzdC5uYW1lKSxcbiAgICAgICAgICAgIGZpeHR1cmVOYW1lOiAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMudGVzdC5maXh0dXJlLm5hbWUpLFxuICAgICAgICAgICAgc2VsZWN0b3JUaW1lb3V0OiAgICAgICAgICAgICAgdGhpcy5vcHRzLnNlbGVjdG9yVGltZW91dCxcbiAgICAgICAgICAgIHBhZ2VMb2FkVGltZW91dDogICAgICAgICAgICAgIHRoaXMucGFnZUxvYWRUaW1lb3V0LFxuICAgICAgICAgICAgc2tpcEpzRXJyb3JzOiAgICAgICAgICAgICAgICAgdGhpcy5vcHRzLnNraXBKc0Vycm9ycyxcbiAgICAgICAgICAgIHJldHJ5VGVzdFBhZ2VzOiAgICAgICAgICAgICAgICEhdGhpcy5vcHRzLnJldHJ5VGVzdFBhZ2VzLFxuICAgICAgICAgICAgc3BlZWQ6ICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGVlZCxcbiAgICAgICAgICAgIGRpYWxvZ0hhbmRsZXI6ICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aXZlRGlhbG9nSGFuZGxlcilcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2dldElmcmFtZVBheWxvYWRTY3JpcHQgKCkge1xuICAgICAgICByZXR1cm4gTXVzdGFjaGUucmVuZGVyKElGUkFNRV9URVNUX1JVTl9URU1QTEFURSwge1xuICAgICAgICAgICAgdGVzdFJ1bklkOiAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnNlc3Npb24uaWQpLFxuICAgICAgICAgICAgc2VsZWN0b3JUaW1lb3V0OiB0aGlzLm9wdHMuc2VsZWN0b3JUaW1lb3V0LFxuICAgICAgICAgICAgcGFnZUxvYWRUaW1lb3V0OiB0aGlzLnBhZ2VMb2FkVGltZW91dCxcbiAgICAgICAgICAgIHJldHJ5VGVzdFBhZ2VzOiAgISF0aGlzLm9wdHMucmV0cnlUZXN0UGFnZXMsXG4gICAgICAgICAgICBzcGVlZDogICAgICAgICAgIHRoaXMuc3BlZWQsXG4gICAgICAgICAgICBkaWFsb2dIYW5kbGVyOiAgIEpTT04uc3RyaW5naWZ5KHRoaXMuYWN0aXZlRGlhbG9nSGFuZGxlcilcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSGFtbWVyaGVhZCBoYW5kbGVyc1xuICAgIGdldEF1dGhDcmVkZW50aWFscyAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRlc3QuYXV0aENyZWRlbnRpYWxzO1xuICAgIH1cblxuICAgIGhhbmRsZUZpbGVEb3dubG9hZCAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSkge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlV2FpdEZvckZpbGVEb3dubG9hZGluZ1Byb21pc2UodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5maWxlRG93bmxvYWRpbmdIYW5kbGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBoYW5kbGVQYWdlRXJyb3IgKGN0eCwgZXJyKSB7XG4gICAgICAgIGlmIChjdHgucmVxLmhlYWRlcnNbVU5TVEFCTEVfTkVUV09SS19NT0RFX0hFQURFUl0pIHtcbiAgICAgICAgICAgIGN0eC5jbG9zZVdpdGhFcnJvcig1MDAsIGVyci50b1N0cmluZygpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG5ldyBQYWdlTG9hZEVycm9yKGVycik7XG5cbiAgICAgICAgY3R4LnJlZGlyZWN0KGN0eC50b1Byb3h5VXJsKCdhYm91dDplcnJvcicpKTtcbiAgICB9XG5cbiAgICAvLyBUZXN0IGZ1bmN0aW9uIGV4ZWN1dGlvblxuICAgIGFzeW5jIF9leGVjdXRlVGVzdEZuIChwaGFzZSwgZm4pIHtcbiAgICAgICAgdGhpcy5waGFzZSA9IHBoYXNlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBmbih0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBsZXQgc2NyZWVuc2hvdFBhdGggPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRzLnRha2VTY3JlZW5zaG90c09uRmFpbHMpXG4gICAgICAgICAgICAgICAgc2NyZWVuc2hvdFBhdGggPSBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBicm93c2VyTWFuaXB1bGF0aW9uQ29tbWFuZHMuVGFrZVNjcmVlbnNob3RPbkZhaWxDb21tYW5kKCkpO1xuXG4gICAgICAgICAgICB0aGlzLmFkZEVycm9yKGVyciwgc2NyZWVuc2hvdFBhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICF0aGlzLl9hZGRQZW5kaW5nUGFnZUVycm9ySWZBbnkoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfcnVuQmVmb3JlSG9vayAoKSB7XG4gICAgICAgIGlmICh0aGlzLnRlc3QuYmVmb3JlRm4pXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pblRlc3RCZWZvcmVIb29rLCB0aGlzLnRlc3QuYmVmb3JlRm4pO1xuXG4gICAgICAgIGlmICh0aGlzLnRlc3QuZml4dHVyZS5iZWZvcmVFYWNoRm4pXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZVRlc3RGbihQSEFTRS5pbkZpeHR1cmVCZWZvcmVFYWNoSG9vaywgdGhpcy50ZXN0LmZpeHR1cmUuYmVmb3JlRWFjaEZuKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhc3luYyBfcnVuQWZ0ZXJIb29rICgpIHtcbiAgICAgICAgaWYgKHRoaXMudGVzdC5hZnRlckZuKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2V4ZWN1dGVUZXN0Rm4oUEhBU0UuaW5UZXN0QWZ0ZXJIb29rLCB0aGlzLnRlc3QuYWZ0ZXJGbik7XG5cbiAgICAgICAgaWYgKHRoaXMudGVzdC5maXh0dXJlLmFmdGVyRWFjaEZuKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2V4ZWN1dGVUZXN0Rm4oUEhBU0UuaW5GaXh0dXJlQWZ0ZXJFYWNoSG9vaywgdGhpcy50ZXN0LmZpeHR1cmUuYWZ0ZXJFYWNoRm4pO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGFzeW5jIHN0YXJ0ICgpIHtcbiAgICAgICAgdGVzdFJ1blRyYWNrZXIuYWN0aXZlVGVzdFJ1bnNbdGhpcy5zZXNzaW9uLmlkXSA9IHRoaXM7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5lbWl0KCdzdGFydCcpO1xuXG4gICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdGVkID0gZXJyID0+IHRoaXMuX2Rpc2Nvbm5lY3QoZXJyKTtcblxuICAgICAgICB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLm9uY2UoJ2Rpc2Nvbm5lY3RlZCcsIG9uRGlzY29ubmVjdGVkKTtcblxuICAgICAgICBhd2FpdCB0aGlzLm9uY2UoJ2Nvbm5lY3RlZCcpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZW1pdCgncmVhZHknKTtcblxuICAgICAgICBpZiAoYXdhaXQgdGhpcy5fcnVuQmVmb3JlSG9vaygpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9leGVjdXRlVGVzdEZuKFBIQVNFLmluVGVzdCwgdGhpcy50ZXN0LmZuKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3J1bkFmdGVySG9vaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdGVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuYnJvd3NlckNvbm5lY3Rpb24ucmVtb3ZlTGlzdGVuZXIoJ2Rpc2Nvbm5lY3RlZCcsIG9uRGlzY29ubmVjdGVkKTtcblxuICAgICAgICBpZiAodGhpcy5lcnJzLmxlbmd0aCAmJiB0aGlzLmRlYnVnT25GYWlsKVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fZW5xdWV1ZVNldEJyZWFrcG9pbnRDb21tYW5kKG51bGwsIHRoaXMuZGVidWdSZXBvcnRlclBsdWdpbkhvc3QuZm9ybWF0RXJyb3IodGhpcy5lcnJzWzBdKSk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5lbWl0KCdiZWZvcmUtZG9uZScpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQobmV3IHNlcnZpY2VDb21tYW5kcy5UZXN0RG9uZUNvbW1hbmQoKSk7XG5cbiAgICAgICAgdGhpcy5fYWRkUGVuZGluZ1BhZ2VFcnJvcklmQW55KCk7XG5cbiAgICAgICAgZGVsZXRlIHRlc3RSdW5UcmFja2VyLmFjdGl2ZVRlc3RSdW5zW3RoaXMuc2Vzc2lvbi5pZF07XG5cbiAgICAgICAgYXdhaXQgdGhpcy5lbWl0KCdkb25lJyk7XG4gICAgfVxuXG4gICAgLy8gRXJyb3JzXG4gICAgX2FkZFBlbmRpbmdQYWdlRXJyb3JJZkFueSAoKSB7XG4gICAgICAgIGlmICh0aGlzLnBlbmRpbmdQYWdlRXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRXJyb3IodGhpcy5wZW5kaW5nUGFnZUVycm9yKTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBfY3JlYXRlRXJyb3JBZGFwdGVyIChlcnIsIHNjcmVlbnNob3RQYXRoKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGVzdFJ1bkVycm9yRm9ybWF0dGFibGVBZGFwdGVyKGVyciwge1xuICAgICAgICAgICAgdXNlckFnZW50OiAgICAgIHRoaXMuYnJvd3NlckNvbm5lY3Rpb24udXNlckFnZW50LFxuICAgICAgICAgICAgc2NyZWVuc2hvdFBhdGg6IHNjcmVlbnNob3RQYXRoIHx8ICcnLFxuICAgICAgICAgICAgdGVzdFJ1blBoYXNlOiAgIHRoaXMucGhhc2VcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkRXJyb3IgKGVyciwgc2NyZWVuc2hvdFBhdGgpIHtcbiAgICAgICAgY29uc3QgZXJyTGlzdCA9IGVyciBpbnN0YW5jZW9mIFRlc3RDYWZlRXJyb3JMaXN0ID8gZXJyLml0ZW1zIDogW2Vycl07XG5cbiAgICAgICAgZXJyTGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgY29uc3QgYWRhcHRlciA9IHRoaXMuX2NyZWF0ZUVycm9yQWRhcHRlcihpdGVtLCBzY3JlZW5zaG90UGF0aCk7XG5cbiAgICAgICAgICAgIHRoaXMuZXJycy5wdXNoKGFkYXB0ZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUYXNrIHF1ZXVlXG4gICAgX2VucXVldWVDb21tYW5kIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUmVxdWVzdClcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVQZW5kaW5nUmVxdWVzdChjb21tYW5kKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50LS07XG4gICAgICAgICAgICB0aGlzLmRyaXZlclRhc2tRdWV1ZS5wdXNoKHsgY29tbWFuZCwgcmVzb2x2ZSwgcmVqZWN0LCBjYWxsc2l0ZSB9KTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmFkZGluZ0RyaXZlclRhc2tzQ291bnQpXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5lbWl0KEFMTF9EUklWRVJfVEFTS1NfQURERURfVE9fUVVFVUVfRVZFTlQsIHRoaXMuZHJpdmVyVGFza1F1ZXVlLmxlbmd0aCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBkcml2ZXJUYXNrUXVldWVMZW5ndGggKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRpbmdEcml2ZXJUYXNrc0NvdW50ID8gcHJvbWlzaWZ5RXZlbnQodGhpcywgQUxMX0RSSVZFUl9UQVNLU19BRERFRF9UT19RVUVVRV9FVkVOVCkgOiBQcm9taXNlLnJlc29sdmUodGhpcy5kcml2ZXJUYXNrUXVldWUubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfZW5xdWV1ZUJyb3dzZXJDb25zb2xlTWVzc2FnZXNDb21tYW5kIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBhd2FpdCB0aGlzLl9lbnF1ZXVlQ29tbWFuZChjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc29sZU1lc3NhZ2VzLmdldENvcHkoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfZW5xdWV1ZVNldEJyZWFrcG9pbnRDb21tYW5kIChjYWxsc2l0ZSwgZXJyb3IpIHtcbiAgICAgICAgaWYgKHRoaXMuYnJvd3NlckNvbm5lY3Rpb24uaXNIZWFkbGVzc0Jyb3dzZXIoKSkge1xuICAgICAgICAgICAgdGhpcy53YXJuaW5nTG9nLmFkZFdhcm5pbmcoV0FSTklOR19NRVNTQUdFLmRlYnVnSW5IZWFkbGVzc0Vycm9yKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlYnVnTG9nZ2VyLnNob3dCcmVha3BvaW50KHRoaXMuc2Vzc2lvbi5pZCwgdGhpcy5icm93c2VyQ29ubmVjdGlvbi51c2VyQWdlbnQsIGNhbGxzaXRlLCBlcnJvcik7XG5cbiAgICAgICAgdGhpcy5kZWJ1Z2dpbmcgPSBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBzZXJ2aWNlQ29tbWFuZHMuU2V0QnJlYWtwb2ludENvbW1hbmQoISFlcnJvciksIGNhbGxzaXRlKTtcbiAgICB9XG5cbiAgICBfcmVtb3ZlQWxsTm9uU2VydmljZVRhc2tzICgpIHtcbiAgICAgICAgdGhpcy5kcml2ZXJUYXNrUXVldWUgPSB0aGlzLmRyaXZlclRhc2tRdWV1ZS5maWx0ZXIoZHJpdmVyVGFzayA9PiBpc1NlcnZpY2VDb21tYW5kKGRyaXZlclRhc2suY29tbWFuZCkpO1xuXG4gICAgICAgIHRoaXMuYnJvd3Nlck1hbmlwdWxhdGlvblF1ZXVlLnJlbW92ZUFsbE5vblNlcnZpY2VNYW5pcHVsYXRpb25zKCk7XG4gICAgfVxuXG4gICAgLy8gQ3VycmVudCBkcml2ZXIgdGFza1xuICAgIGdldCBjdXJyZW50RHJpdmVyVGFzayAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRyaXZlclRhc2tRdWV1ZVswXTtcbiAgICB9XG5cbiAgICBfcmVzb2x2ZUN1cnJlbnREcml2ZXJUYXNrIChyZXN1bHQpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RHJpdmVyVGFzay5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIHRoaXMuZHJpdmVyVGFza1F1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMudGVzdERvbmVDb21tYW5kUXVldWVkKVxuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQWxsTm9uU2VydmljZVRhc2tzKCk7XG4gICAgfVxuXG4gICAgX3JlamVjdEN1cnJlbnREcml2ZXJUYXNrIChlcnIpIHtcbiAgICAgICAgZXJyLmNhbGxzaXRlICAgICAgICAgICAgID0gZXJyLmNhbGxzaXRlIHx8IHRoaXMuY3VycmVudERyaXZlclRhc2suY2FsbHNpdGU7XG4gICAgICAgIGVyci5pc1JlamVjdGVkRHJpdmVyVGFzayA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50RHJpdmVyVGFzay5yZWplY3QoZXJyKTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlQWxsTm9uU2VydmljZVRhc2tzKCk7XG4gICAgfVxuXG4gICAgLy8gUGVuZGluZyByZXF1ZXN0XG4gICAgX2NsZWFyUGVuZGluZ1JlcXVlc3QgKCkge1xuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUmVxdWVzdCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGVuZGluZ1JlcXVlc3QucmVzcG9uc2VUaW1lb3V0KTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3Jlc29sdmVQZW5kaW5nUmVxdWVzdCAoY29tbWFuZCkge1xuICAgICAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZSA9IGNvbW1hbmQ7XG4gICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3QucmVzb2x2ZShjb21tYW5kKTtcbiAgICAgICAgdGhpcy5fY2xlYXJQZW5kaW5nUmVxdWVzdCgpO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSBkcml2ZXIgcmVxdWVzdFxuICAgIF9mdWxmaWxsQ3VycmVudERyaXZlclRhc2sgKGRyaXZlclN0YXR1cykge1xuICAgICAgICBpZiAoZHJpdmVyU3RhdHVzLmV4ZWN1dGlvbkVycm9yKVxuICAgICAgICAgICAgdGhpcy5fcmVqZWN0Q3VycmVudERyaXZlclRhc2soZHJpdmVyU3RhdHVzLmV4ZWN1dGlvbkVycm9yKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUN1cnJlbnREcml2ZXJUYXNrKGRyaXZlclN0YXR1cy5yZXN1bHQpO1xuICAgIH1cblxuICAgIF9oYW5kbGVQYWdlRXJyb3JTdGF0dXMgKHBhZ2VFcnJvcikge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50RHJpdmVyVGFzayAmJiBpc0NvbW1hbmRSZWplY3RhYmxlQnlQYWdlRXJyb3IodGhpcy5jdXJyZW50RHJpdmVyVGFzay5jb21tYW5kKSkge1xuICAgICAgICAgICAgdGhpcy5fcmVqZWN0Q3VycmVudERyaXZlclRhc2socGFnZUVycm9yKTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1BhZ2VFcnJvciA9IG51bGw7XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wZW5kaW5nUGFnZUVycm9yID0gdGhpcy5wZW5kaW5nUGFnZUVycm9yIHx8IHBhZ2VFcnJvcjtcblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgX2hhbmRsZURyaXZlclJlcXVlc3QgKGRyaXZlclN0YXR1cykge1xuICAgICAgICBjb25zdCBpc1Rlc3REb25lICAgICAgICAgICAgICAgICA9IHRoaXMuY3VycmVudERyaXZlclRhc2sgJiYgdGhpcy5jdXJyZW50RHJpdmVyVGFzay5jb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS50ZXN0RG9uZTtcbiAgICAgICAgY29uc3QgcGFnZUVycm9yICAgICAgICAgICAgICAgICAgPSB0aGlzLnBlbmRpbmdQYWdlRXJyb3IgfHwgZHJpdmVyU3RhdHVzLnBhZ2VFcnJvcjtcbiAgICAgICAgY29uc3QgY3VycmVudFRhc2tSZWplY3RlZEJ5RXJyb3IgPSBwYWdlRXJyb3IgJiYgdGhpcy5faGFuZGxlUGFnZUVycm9yU3RhdHVzKHBhZ2VFcnJvcik7XG5cbiAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdGVkKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHJlamVjdCgpKTtcblxuICAgICAgICB0aGlzLmNvbnNvbGVNZXNzYWdlcy5jb25jYXQoZHJpdmVyU3RhdHVzLmNvbnNvbGVNZXNzYWdlcyk7XG5cbiAgICAgICAgaWYgKCFjdXJyZW50VGFza1JlamVjdGVkQnlFcnJvciAmJiBkcml2ZXJTdGF0dXMuaXNDb21tYW5kUmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAoaXNUZXN0RG9uZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVDdXJyZW50RHJpdmVyVGFzaygpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFRFU1RfRE9ORV9DT05GSVJNQVRJT05fUkVTUE9OU0U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2Z1bGZpbGxDdXJyZW50RHJpdmVyVGFzayhkcml2ZXJTdGF0dXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEN1cnJlbnREcml2ZXJUYXNrQ29tbWFuZCgpO1xuICAgIH1cblxuICAgIF9nZXRDdXJyZW50RHJpdmVyVGFza0NvbW1hbmQgKCkge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudERyaXZlclRhc2spXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBjb25zdCBjb21tYW5kID0gdGhpcy5jdXJyZW50RHJpdmVyVGFzay5jb21tYW5kO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5uYXZpZ2F0ZVRvICYmIGNvbW1hbmQuc3RhdGVTbmFwc2hvdClcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi51c2VTdGF0ZVNuYXBzaG90KEpTT04ucGFyc2UoY29tbWFuZC5zdGF0ZVNuYXBzaG90KSk7XG5cbiAgICAgICAgcmV0dXJuIGNvbW1hbmQ7XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0ZSBjb21tYW5kXG4gICAgYXN5bmMgX2V4ZWN1dGVFeHByZXNzaW9uIChjb21tYW5kKSB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0VmFyaWFibGVOYW1lLCBpc0FzeW5jRXhwcmVzc2lvbiB9ID0gY29tbWFuZDtcblxuICAgICAgICBsZXQgZXhwcmVzc2lvbiA9IGNvbW1hbmQuZXhwcmVzc2lvbjtcblxuICAgICAgICBpZiAoaXNBc3luY0V4cHJlc3Npb24pXG4gICAgICAgICAgICBleHByZXNzaW9uID0gYGF3YWl0ICR7ZXhwcmVzc2lvbn1gO1xuXG4gICAgICAgIGlmIChyZXN1bHRWYXJpYWJsZU5hbWUpXG4gICAgICAgICAgICBleHByZXNzaW9uID0gYCR7cmVzdWx0VmFyaWFibGVOYW1lfSA9ICR7ZXhwcmVzc2lvbn0sICR7cmVzdWx0VmFyaWFibGVOYW1lfWA7XG5cbiAgICAgICAgaWYgKGlzQXN5bmNFeHByZXNzaW9uKVxuICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGAoYXN5bmMgKCkgPT4geyByZXR1cm4gJHtleHByZXNzaW9ufTsgfSkuYXBwbHkodGhpcyk7YDtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBleGVjdXRlSnNFeHByZXNzaW9uKGV4cHJlc3Npb24sIHRoaXMsIHsgc2tpcFZpc2liaWxpdHlDaGVjazogZmFsc2UgfSk7XG5cbiAgICAgICAgcmV0dXJuIGlzQXN5bmNFeHByZXNzaW9uID8gYXdhaXQgcmVzdWx0IDogcmVzdWx0O1xuICAgIH1cblxuICAgIGFzeW5jIF9leGVjdXRlQXNzZXJ0aW9uIChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBjb25zdCBhc3NlcnRpb25UaW1lb3V0ID0gY29tbWFuZC5vcHRpb25zLnRpbWVvdXQgPT09IHZvaWQgMCA/IHRoaXMub3B0cy5hc3NlcnRpb25UaW1lb3V0IDogY29tbWFuZC5vcHRpb25zLnRpbWVvdXQ7XG4gICAgICAgIGNvbnN0IGV4ZWN1dG9yICAgICAgICAgPSBuZXcgQXNzZXJ0aW9uRXhlY3V0b3IoY29tbWFuZCwgYXNzZXJ0aW9uVGltZW91dCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIGV4ZWN1dG9yLm9uY2UoJ3N0YXJ0LWFzc2VydGlvbi1yZXRyaWVzJywgdGltZW91dCA9PiB0aGlzLmV4ZWN1dGVDb21tYW5kKG5ldyBzZXJ2aWNlQ29tbWFuZHMuU2hvd0Fzc2VydGlvblJldHJpZXNTdGF0dXNDb21tYW5kKHRpbWVvdXQpKSk7XG4gICAgICAgIGV4ZWN1dG9yLm9uY2UoJ2VuZC1hc3NlcnRpb24tcmV0cmllcycsIHN1Y2Nlc3MgPT4gdGhpcy5leGVjdXRlQ29tbWFuZChuZXcgc2VydmljZUNvbW1hbmRzLkhpZGVBc3NlcnRpb25SZXRyaWVzU3RhdHVzQ29tbWFuZChzdWNjZXNzKSkpO1xuXG4gICAgICAgIHJldHVybiBleGVjdXRvci5ydW4oKTtcbiAgICB9XG5cbiAgICBfYWRqdXN0Q29uZmlndXJhdGlvbldpdGhDb21tYW5kIChjb21tYW5kKSB7XG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS50ZXN0RG9uZSkge1xuICAgICAgICAgICAgdGhpcy50ZXN0RG9uZUNvbW1hbmRRdWV1ZWQgPSB0cnVlO1xuICAgICAgICAgICAgZGVidWdMb2dnZXIuaGlkZUJyZWFrcG9pbnQodGhpcy5zZXNzaW9uLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLnNldE5hdGl2ZURpYWxvZ0hhbmRsZXIpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZURpYWxvZ0hhbmRsZXIgPSBjb21tYW5kLmRpYWxvZ0hhbmRsZXI7XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuc3dpdGNoVG9JZnJhbWUpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUlmcmFtZVNlbGVjdG9yID0gY29tbWFuZC5zZWxlY3RvcjtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zd2l0Y2hUb01haW5XaW5kb3cpXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUlmcmFtZVNlbGVjdG9yID0gbnVsbDtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXRUZXN0U3BlZWQpXG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gY29tbWFuZC5zcGVlZDtcblxuICAgICAgICBlbHNlIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5zZXRQYWdlTG9hZFRpbWVvdXQpXG4gICAgICAgICAgICB0aGlzLnBhZ2VMb2FkVGltZW91dCA9IGNvbW1hbmQuZHVyYXRpb247XG5cbiAgICAgICAgZWxzZSBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuZGVidWcpXG4gICAgICAgICAgICB0aGlzLmRlYnVnZ2luZyA9IHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgX2FkanVzdFNjcmVlbnNob3RDb21tYW5kIChjb21tYW5kKSB7XG4gICAgICAgIGNvbnN0IGJyb3dzZXJJZCAgICAgICAgICAgICAgICAgICAgPSB0aGlzLmJyb3dzZXJDb25uZWN0aW9uLmlkO1xuICAgICAgICBjb25zdCB7IGhhc0Nocm9tZWxlc3NTY3JlZW5zaG90cyB9ID0gYXdhaXQgdGhpcy5icm93c2VyQ29ubmVjdGlvbi5wcm92aWRlci5oYXNDdXN0b21BY3Rpb25Gb3JCcm93c2VyKGJyb3dzZXJJZCk7XG5cbiAgICAgICAgaWYgKCFoYXNDaHJvbWVsZXNzU2NyZWVuc2hvdHMpXG4gICAgICAgICAgICBjb21tYW5kLmdlbmVyYXRlU2NyZWVuc2hvdE1hcmsoKTtcbiAgICB9XG5cbiAgICBhc3luYyBfc2V0QnJlYWtwb2ludElmTmVjZXNzYXJ5IChjb21tYW5kLCBjYWxsc2l0ZSkge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZURlYnVnQnJlYWtwb2ludHMgJiYgdGhpcy5kZWJ1Z2dpbmcgJiYgY2FuU2V0RGVidWdnZXJCcmVha3BvaW50QmVmb3JlQ29tbWFuZChjb21tYW5kKSlcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2VucXVldWVTZXRCcmVha3BvaW50Q29tbWFuZChjYWxsc2l0ZSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNvbW1hbmQsIGNhbGxzaXRlKSB7XG4gICAgICAgIHRoaXMuZGVidWdMb2cuY29tbWFuZChjb21tYW5kKTtcblxuICAgICAgICBpZiAodGhpcy5wZW5kaW5nUGFnZUVycm9yICYmIGlzQ29tbWFuZFJlamVjdGFibGVCeVBhZ2VFcnJvcihjb21tYW5kKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWplY3RDb21tYW5kV2l0aFBhZ2VFcnJvcihjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGlzRXhlY3V0YWJsZU9uQ2xpZW50Q29tbWFuZChjb21tYW5kKSlcbiAgICAgICAgICAgIHRoaXMuYWRkaW5nRHJpdmVyVGFza3NDb3VudCsrO1xuXG4gICAgICAgIHRoaXMuX2FkanVzdENvbmZpZ3VyYXRpb25XaXRoQ29tbWFuZChjb21tYW5kKTtcblxuICAgICAgICBhd2FpdCB0aGlzLl9zZXRCcmVha3BvaW50SWZOZWNlc3NhcnkoY29tbWFuZCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChpc1NjcmVlbnNob3RDb21tYW5kKGNvbW1hbmQpKVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fYWRqdXN0U2NyZWVuc2hvdENvbW1hbmQoY29tbWFuZCk7XG5cbiAgICAgICAgaWYgKGlzQnJvd3Nlck1hbmlwdWxhdGlvbkNvbW1hbmQoY29tbWFuZCkpXG4gICAgICAgICAgICB0aGlzLmJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZS5wdXNoKGNvbW1hbmQpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS53YWl0KVxuICAgICAgICAgICAgcmV0dXJuIGRlbGF5KGNvbW1hbmQudGltZW91dCk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLnNldFBhZ2VMb2FkVGltZW91dClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5kZWJ1ZylcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9lbnF1ZXVlU2V0QnJlYWtwb2ludENvbW1hbmQoY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS51c2VSb2xlKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3VzZVJvbGUoY29tbWFuZC5yb2xlLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgaWYgKGNvbW1hbmQudHlwZSA9PT0gQ09NTUFORF9UWVBFLmFzc2VydGlvbilcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9leGVjdXRlQXNzZXJ0aW9uKGNvbW1hbmQsIGNhbGxzaXRlKTtcblxuICAgICAgICBpZiAoY29tbWFuZC50eXBlID09PSBDT01NQU5EX1RZUEUuZXhlY3V0ZUV4cHJlc3Npb24pXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZXhlY3V0ZUV4cHJlc3Npb24oY29tbWFuZCwgY2FsbHNpdGUpO1xuXG4gICAgICAgIGlmIChjb21tYW5kLnR5cGUgPT09IENPTU1BTkRfVFlQRS5nZXRCcm93c2VyQ29uc29sZU1lc3NhZ2VzKVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2VucXVldWVCcm93c2VyQ29uc29sZU1lc3NhZ2VzQ29tbWFuZChjb21tYW5kLCBjYWxsc2l0ZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2VucXVldWVDb21tYW5kKGNvbW1hbmQsIGNhbGxzaXRlKTtcbiAgICB9XG5cbiAgICBfcmVqZWN0Q29tbWFuZFdpdGhQYWdlRXJyb3IgKGNhbGxzaXRlKSB7XG4gICAgICAgIGNvbnN0IGVyciA9IHRoaXMucGVuZGluZ1BhZ2VFcnJvcjtcblxuICAgICAgICBlcnIuY2FsbHNpdGUgICAgICAgICAgPSBjYWxsc2l0ZTtcbiAgICAgICAgdGhpcy5wZW5kaW5nUGFnZUVycm9yID0gbnVsbDtcblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICB9XG5cbiAgICAvLyBSb2xlIG1hbmFnZW1lbnRcbiAgICBhc3luYyBnZXRTdGF0ZVNuYXBzaG90ICgpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnNlc3Npb24uZ2V0U3RhdGVTbmFwc2hvdCgpO1xuXG4gICAgICAgIHN0YXRlLnN0b3JhZ2VzID0gYXdhaXQgdGhpcy5leGVjdXRlQ29tbWFuZChuZXcgc2VydmljZUNvbW1hbmRzLkJhY2t1cFN0b3JhZ2VzQ29tbWFuZCgpKTtcblxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgYXN5bmMgc3dpdGNoVG9DbGVhblJ1biAoKSB7XG4gICAgICAgIHRoaXMuY3R4ICAgICAgICAgICAgID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgdGhpcy5maXh0dXJlQ3R4ICAgICAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICB0aGlzLmNvbnNvbGVNZXNzYWdlcyA9IG5ldyBCcm93c2VyQ29uc29sZU1lc3NhZ2VzKCk7XG5cbiAgICAgICAgdGhpcy5zZXNzaW9uLnVzZVN0YXRlU25hcHNob3QobnVsbCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlRGlhbG9nSGFuZGxlcikge1xuICAgICAgICAgICAgY29uc3QgcmVtb3ZlRGlhbG9nSGFuZGxlckNvbW1hbmQgPSBuZXcgYWN0aW9uQ29tbWFuZHMuU2V0TmF0aXZlRGlhbG9nSGFuZGxlckNvbW1hbmQoeyBkaWFsb2dIYW5kbGVyOiB7IGZuOiBudWxsIH0gfSk7XG5cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQocmVtb3ZlRGlhbG9nSGFuZGxlckNvbW1hbmQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc3BlZWQgIT09IHRoaXMub3B0cy5zcGVlZCkge1xuICAgICAgICAgICAgY29uc3Qgc2V0U3BlZWRDb21tYW5kID0gbmV3IGFjdGlvbkNvbW1hbmRzLlNldFRlc3RTcGVlZENvbW1hbmQoeyBzcGVlZDogdGhpcy5vcHRzLnNwZWVkIH0pO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKHNldFNwZWVkQ29tbWFuZCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wYWdlTG9hZFRpbWVvdXQgIT09IHRoaXMub3B0cy5wYWdlTG9hZFRpbWVvdXQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQgPSBuZXcgYWN0aW9uQ29tbWFuZHMuU2V0UGFnZUxvYWRUaW1lb3V0Q29tbWFuZCh7IGR1cmF0aW9uOiB0aGlzLm9wdHMucGFnZUxvYWRUaW1lb3V0IH0pO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKHNldFBhZ2VMb2FkVGltZW91dENvbW1hbmQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgX2dldFN0YXRlU25hcHNob3RGcm9tUm9sZSAocm9sZSkge1xuICAgICAgICBjb25zdCBwcmV2UGhhc2UgPSB0aGlzLnBoYXNlO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSBQSEFTRS5pblJvbGVJbml0aWFsaXplcjtcblxuICAgICAgICBpZiAocm9sZS5waGFzZSA9PT0gUk9MRV9QSEFTRS51bmluaXRpYWxpemVkKVxuICAgICAgICAgICAgYXdhaXQgcm9sZS5pbml0aWFsaXplKHRoaXMpO1xuXG4gICAgICAgIGVsc2UgaWYgKHJvbGUucGhhc2UgPT09IFJPTEVfUEhBU0UucGVuZGluZ0luaXRpYWxpemF0aW9uKVxuICAgICAgICAgICAgYXdhaXQgcHJvbWlzaWZ5RXZlbnQocm9sZSwgJ2luaXRpYWxpemVkJyk7XG5cbiAgICAgICAgaWYgKHJvbGUuaW5pdEVycilcbiAgICAgICAgICAgIHRocm93IHJvbGUuaW5pdEVycjtcblxuICAgICAgICB0aGlzLnBoYXNlID0gcHJldlBoYXNlO1xuXG4gICAgICAgIHJldHVybiByb2xlLnN0YXRlU25hcHNob3Q7XG4gICAgfVxuXG4gICAgYXN5bmMgX3VzZVJvbGUgKHJvbGUsIGNhbGxzaXRlKSB7XG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09PSBQSEFTRS5pblJvbGVJbml0aWFsaXplcilcbiAgICAgICAgICAgIHRocm93IG5ldyBSb2xlU3dpdGNoSW5Sb2xlSW5pdGlhbGl6ZXJFcnJvcihjYWxsc2l0ZSk7XG5cbiAgICAgICAgdGhpcy5kaXNhYmxlRGVidWdCcmVha3BvaW50cyA9IHRydWU7XG5cbiAgICAgICAgY29uc3QgYm9va21hcmsgPSBuZXcgVGVzdFJ1bkJvb2ttYXJrKHRoaXMsIHJvbGUpO1xuXG4gICAgICAgIGF3YWl0IGJvb2ttYXJrLmluaXQoKTtcblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Um9sZUlkKVxuICAgICAgICAgICAgdGhpcy51c2VkUm9sZVN0YXRlc1t0aGlzLmN1cnJlbnRSb2xlSWRdID0gYXdhaXQgdGhpcy5nZXRTdGF0ZVNuYXBzaG90KCk7XG5cbiAgICAgICAgY29uc3Qgc3RhdGVTbmFwc2hvdCA9IHRoaXMudXNlZFJvbGVTdGF0ZXNbcm9sZS5pZF0gfHwgYXdhaXQgdGhpcy5fZ2V0U3RhdGVTbmFwc2hvdEZyb21Sb2xlKHJvbGUpO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvbi51c2VTdGF0ZVNuYXBzaG90KHN0YXRlU25hcHNob3QpO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFJvbGVJZCA9IHJvbGUuaWQ7XG5cbiAgICAgICAgYXdhaXQgYm9va21hcmsucmVzdG9yZShjYWxsc2l0ZSwgc3RhdGVTbmFwc2hvdCk7XG5cbiAgICAgICAgdGhpcy5kaXNhYmxlRGVidWdCcmVha3BvaW50cyA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEdldCBjdXJyZW50IFVSTFxuICAgIGFzeW5jIGdldEN1cnJlbnRVcmwgKCkge1xuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IENsaWVudEZ1bmN0aW9uQnVpbGRlcigoKSA9PiB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby11bmRlZiAqL1xuICAgICAgICB9LCB7IGJvdW5kVGVzdFJ1bjogdGhpcyB9KTtcblxuICAgICAgICBjb25zdCBnZXRMb2NhdGlvbiA9IGJ1aWxkZXIuZ2V0RnVuY3Rpb24oKTtcblxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0TG9jYXRpb24oKTtcbiAgICB9XG5cbiAgICBfZGlzY29ubmVjdCAoZXJyKSB7XG4gICAgICAgIHRoaXMuZGlzY29ubmVjdGVkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLl9yZWplY3RDdXJyZW50RHJpdmVyVGFzayhlcnIpO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnZGlzY29ubmVjdGVkJywgZXJyKTtcblxuICAgICAgICBkZWxldGUgdGVzdFJ1blRyYWNrZXIuYWN0aXZlVGVzdFJ1bnNbdGhpcy5zZXNzaW9uLmlkXTtcbiAgICB9XG59XG5cbi8vIFNlcnZpY2UgbWVzc2FnZSBoYW5kbGVyc1xuY29uc3QgU2VydmljZU1lc3NhZ2VzID0gVGVzdFJ1bi5wcm90b3R5cGU7XG5cbi8vIE5PVEU6IHRoaXMgZnVuY3Rpb24gaXMgdGltZS1jcml0aWNhbCBhbmQgbXVzdCByZXR1cm4gQVNBUCB0byBhdm9pZCBjbGllbnQgZGlzY29ubmVjdGlvblxuU2VydmljZU1lc3NhZ2VzW0NMSUVOVF9NRVNTQUdFUy5yZWFkeV0gPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgdGhpcy5kZWJ1Z0xvZy5kcml2ZXJNZXNzYWdlKG1zZyk7XG5cbiAgICB0aGlzLmVtaXQoJ2Nvbm5lY3RlZCcpO1xuXG4gICAgdGhpcy5fY2xlYXJQZW5kaW5nUmVxdWVzdCgpO1xuXG4gICAgLy8gTk9URTogdGhlIGRyaXZlciBzZW5kcyB0aGUgc3RhdHVzIGZvciB0aGUgc2Vjb25kIHRpbWUgaWYgaXQgZGlkbid0IGdldCBhIHJlc3BvbnNlIGF0IHRoZVxuICAgIC8vIGZpcnN0IHRyeS4gVGhpcyBpcyBwb3NzaWJsZSB3aGVuIHRoZSBwYWdlIHdhcyB1bmxvYWRlZCBhZnRlciB0aGUgZHJpdmVyIHNlbnQgdGhlIHN0YXR1cy5cbiAgICBpZiAobXNnLnN0YXR1cy5pZCA9PT0gdGhpcy5sYXN0RHJpdmVyU3RhdHVzSWQpXG4gICAgICAgIHJldHVybiB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZTtcblxuICAgIHRoaXMubGFzdERyaXZlclN0YXR1c0lkICAgICAgID0gbXNnLnN0YXR1cy5pZDtcbiAgICB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZSA9IHRoaXMuX2hhbmRsZURyaXZlclJlcXVlc3QobXNnLnN0YXR1cyk7XG5cbiAgICBpZiAodGhpcy5sYXN0RHJpdmVyU3RhdHVzUmVzcG9uc2UpXG4gICAgICAgIHJldHVybiB0aGlzLmxhc3REcml2ZXJTdGF0dXNSZXNwb25zZTtcblxuICAgIC8vIE5PVEU6IHdlIHNlbmQgYW4gZW1wdHkgcmVzcG9uc2UgYWZ0ZXIgdGhlIE1BWF9SRVNQT05TRV9ERUxBWSB0aW1lb3V0IGlzIGV4Y2VlZGVkIHRvIGtlZXAgY29ubmVjdGlvblxuICAgIC8vIHdpdGggdGhlIGNsaWVudCBhbmQgcHJldmVudCB0aGUgcmVzcG9uc2UgdGltZW91dCBleGNlcHRpb24gb24gdGhlIGNsaWVudCBzaWRlXG4gICAgY29uc3QgcmVzcG9uc2VUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLl9yZXNvbHZlUGVuZGluZ1JlcXVlc3QobnVsbCksIE1BWF9SRVNQT05TRV9ERUxBWSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0ID0geyByZXNvbHZlLCByZWplY3QsIHJlc3BvbnNlVGltZW91dCB9O1xuICAgIH0pO1xufTtcblxuU2VydmljZU1lc3NhZ2VzW0NMSUVOVF9NRVNTQUdFUy5yZWFkeUZvckJyb3dzZXJNYW5pcHVsYXRpb25dID0gYXN5bmMgZnVuY3Rpb24gKG1zZykge1xuICAgIHRoaXMuZGVidWdMb2cuZHJpdmVyTWVzc2FnZShtc2cpO1xuXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgbGV0IGVycm9yICA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmJyb3dzZXJNYW5pcHVsYXRpb25RdWV1ZS5leGVjdXRlUGVuZGluZ01hbmlwdWxhdGlvbihtc2cpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGVycm9yID0gZXJyO1xuICAgIH1cblxuICAgIHJldHVybiB7IHJlc3VsdCwgZXJyb3IgfTtcbn07XG5cblNlcnZpY2VNZXNzYWdlc1tDTElFTlRfTUVTU0FHRVMud2FpdEZvckZpbGVEb3dubG9hZF0gPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgdGhpcy5kZWJ1Z0xvZy5kcml2ZXJNZXNzYWdlKG1zZyk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmZpbGVEb3dubG9hZGluZ0hhbmRsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZURvd25sb2FkaW5nSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnJlc29sdmVXYWl0Rm9yRmlsZURvd25sb2FkaW5nUHJvbWlzZSA9IHJlc29sdmU7XG4gICAgfSk7XG59O1xuIl19
